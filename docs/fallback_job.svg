<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="843px" preserveAspectRatio="none" style="width:836px;height:843px;" version="1.1" viewBox="0 0 836 843" width="836px" zoomAndPan="magnify"><defs><filter height="300%" id="fy1ujpulc961d" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#ADD8E6" height="828.2562" style="stroke: #A80036; stroke-width: 1.0;" width="350" x="458" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="124" x="571" y="17.897">Pod (Job Container)</text><rect fill="#FFFFFF" filter="url(#fy1ujpulc961d)" height="526.0023" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="491.5" y="199.186"/><rect fill="#FFFFFF" filter="url(#fy1ujpulc961d)" height="350.7662" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="748.5" y="374.4221"/><rect fill="#FFFFFF" filter="url(#fy1ujpulc961d)" height="95.118" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="753.5" y="591.3642"/><rect fill="#FFFFFF" filter="url(#fy1ujpulc961d)" height="146.5301" style="stroke: #000000; stroke-width: 2.0;" width="801" x="13" y="547.9521"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="45" x2="45" y1="89.0679" y2="743.1882"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="204" x2="204" y1="89.0679" y2="743.1882"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="496" x2="496" y1="89.0679" y2="743.1882"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="753" x2="753" y1="89.0679" y2="743.1882"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="23" y="84.9659">Client</text><ellipse cx="45.5" cy="13" fill="#FEFECE" filter="url(#fy1ujpulc961d)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M45.5,21 L45.5,48 M32.5,29 L58.5,29 M45.5,48 L32.5,63 M45.5,48 L58.5,63 " fill="none" filter="url(#fy1ujpulc961d)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="23" y="757.1542">Client</text><ellipse cx="45.5" cy="771.2562" fill="#FEFECE" filter="url(#fy1ujpulc961d)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M45.5,779.2562 L45.5,806.2562 M32.5,787.2562 L58.5,787.2562 M45.5,806.2562 L32.5,821.2562 M45.5,806.2562 L58.5,821.2562 " fill="none" filter="url(#fy1ujpulc961d)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fy1ujpulc961d)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="111" x="147" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="97" x="154" y="72.9659">Fallback Client</text><rect fill="#FEFECE" filter="url(#fy1ujpulc961d)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="111" x="147" y="742.1882"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="97" x="154" y="764.1542">Fallback Client</text><rect fill="#FEFECE" filter="url(#fy1ujpulc961d)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="65" x="462" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="51" x="469" y="72.9659">Process</text><rect fill="#FEFECE" filter="url(#fy1ujpulc961d)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="65" x="462" y="742.1882"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="51" x="469" y="764.1542">Process</text><rect fill="#FEFECE" filter="url(#fy1ujpulc961d)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="703" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="710" y="72.9659">Proxy Server</text><rect fill="#FEFECE" filter="url(#fy1ujpulc961d)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="703" y="742.1882"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="710" y="764.1542">Proxy Server</text><rect fill="#FFFFFF" filter="url(#fy1ujpulc961d)" height="526.0023" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="491.5" y="199.186"/><rect fill="#FFFFFF" filter="url(#fy1ujpulc961d)" height="350.7662" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="748.5" y="374.4221"/><rect fill="#FFFFFF" filter="url(#fy1ujpulc961d)" height="95.118" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="753.5" y="591.3642"/><polygon fill="#A80036" points="192.5,118.7739,202.5,122.7739,192.5,126.7739,196.5,122.7739" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="45.5" x2="198.5" y1="122.7739" y2="122.7739"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="52.5" y="116.9649">Request streaming job</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="204.5" x2="246.5" y1="154.4799" y2="154.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="246.5" x2="246.5" y1="154.4799" y2="167.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="205.5" x2="246.5" y1="167.4799" y2="167.4799"/><polygon fill="#A80036" points="215.5,163.4799,205.5,167.4799,215.5,171.4799,211.5,167.4799" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="211.5" y="148.6709">Generate client certificate</text><polygon fill="#A80036" points="479.5,195.186,489.5,199.186,479.5,203.186,483.5,199.186" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="204.5" x2="485.5" y1="199.186" y2="199.186"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="211.5" y="193.377">Request process creation</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501.5" x2="543.5" y1="248.598" y2="248.598"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543.5" x2="543.5" y1="248.598" y2="261.598"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502.5" x2="543.5" y1="261.598" y2="261.598"/><polygon fill="#A80036" points="512.5,257.598,502.5,261.598,512.5,265.598,508.5,261.598" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="508.5" y="225.083">Start job container</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="508.5" y="242.789">Install NGINX</text><polygon fill="#A80036" points="479.5,289.304,489.5,293.304,479.5,297.304,483.5,293.304" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="204.5" x2="485.5" y1="293.304" y2="293.304"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="263" x="211.5" y="287.495">Upload client certificate (InlineInputVolume)</text><polygon fill="#A80036" points="215.5,321.01,205.5,325.01,215.5,329.01,211.5,325.01" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="209.5" x2="490.5" y1="325.01" y2="325.01"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="221.5" y="319.201">Container is ready</text><polygon fill="#A80036" points="736.5,370.4221,746.5,374.4221,736.5,378.4221,740.5,374.4221" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501.5" x2="742.5" y1="374.4221" y2="374.4221"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="508.5" y="350.907">Generate server certificate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="508.5" y="368.6131">Start proxy server (requires client cert)</text><polygon fill="#A80036" points="479.5,402.1281,489.5,406.1281,479.5,410.1281,483.5,406.1281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="204.5" x2="485.5" y1="406.1281" y2="406.1281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="211.5" y="400.3191">Poll for server certificate (rsync)</text><polygon fill="#A80036" points="215.5,433.8341,205.5,437.8341,215.5,441.8341,211.5,437.8341" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="209.5" x2="490.5" y1="437.8341" y2="437.8341"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="221.5" y="432.0251">Return server public certificate</text><polygon fill="#A80036" points="56.5,483.2461,46.5,487.2461,56.5,491.2461,52.5,487.2461" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="50.5" x2="203.5" y1="487.2461" y2="487.2461"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="62.5" y="463.7311">Return server address</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="62.5" y="481.4371">and public certificate</text><rect fill="#EEEEEE" filter="url(#fy1ujpulc961d)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="821" x="3" y="517.0991"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="824" y1="517.0991" y2="517.0991"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="824" y1="520.0991" y2="520.0991"/><rect fill="#EEEEEE" filter="url(#fy1ujpulc961d)" height="25.706" style="stroke: #000000; stroke-width: 2.0;" width="128" x="349.5" y="505.2461"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111" x="355.5" y="523.1431">Streaming Phase</text><path d="M13,547.9521 L86,547.9521 L86,556.9521 L76,566.9521 L13,566.9521 L13,547.9521 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="146.5301" style="stroke: #000000; stroke-width: 2.0;" width="801" x="13" y="547.9521"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="28" y="562.8492">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="263" x="101" y="561.7111">[Streaming until client finishes or job times out]</text><polygon fill="#A80036" points="741.5,587.3642,751.5,591.3642,741.5,595.3642,745.5,591.3642" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="45.5" x2="747.5" y1="591.3642" y2="591.3642"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="52.5" y="585.5552">Request (signed with client cert)</text><polygon fill="#A80036" points="512.5,619.0702,502.5,623.0702,512.5,627.0702,508.5,623.0702" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="506.5" x2="752.5" y1="623.0702" y2="623.0702"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="518.5" y="617.2612">Forward to unsafe HTTP app</text><polygon fill="#A80036" points="741.5,650.7762,751.5,654.7762,741.5,658.7762,745.5,654.7762" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="501.5" x2="747.5" y1="654.7762" y2="654.7762"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="508.5" y="648.9672">Response from app</text><polygon fill="#A80036" points="56.5,682.4822,46.5,686.4822,56.5,690.4822,52.5,686.4822" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="50.5" x2="747.5" y1="686.4822" y2="686.4822"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="62.5" y="680.6732">Response (signed with server cert)</text><polygon fill="#A80036" points="56.5,721.1882,46.5,725.1882,56.5,729.1882,52.5,725.1882" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="50.5" x2="495.5" y1="725.1882" y2="725.1882"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="62.5" y="719.3792">Job finished</text><!--MD5=[298423a8f471ccc8584b45c38b794660]
@startuml
actor Client
participant "Fallback Client"
box "Pod (Job Container)" #LightBlue
  participant Process
  participant "Proxy Server"
end box

Client -> "Fallback Client": Request streaming job
"Fallback Client" -> "Fallback Client": Generate client certificate

"Fallback Client" -> Process: Request process creation
activate Process
Process -> Process: Start job container\nInstall NGINX
"Fallback Client" -> Process: Upload client certificate (InlineInputVolume)
Process -> "Fallback Client": Container is ready

Process -> "Proxy Server": Generate server certificate\nStart proxy server (requires client cert)
activate "Proxy Server"
"Fallback Client" -> Process: Poll for server certificate (rsync)
Process -> "Fallback Client": Return server public certificate

"Fallback Client" -> Client: Return server address\nand public certificate

== Streaming Phase ==
loop Streaming until client finishes or job times out
  Client -> "Proxy Server": Request (signed with client cert)
  activate "Proxy Server"
  "Proxy Server" -> Process: Forward to unsafe HTTP app
  Process - -> "Proxy Server": Response from app
  "Proxy Server" -> Client: Response (signed with server cert)
  deactivate "Proxy Server"
end

Process -> Client: Job finished
deactivate "Proxy Server"
deactivate Process

@enduml

PlantUML version 1.2020.02(Sun Mar 01 11:22:07 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 21.0.7+6-Ubuntu-0ubuntu124.04
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>