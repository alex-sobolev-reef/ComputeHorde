<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="932px" preserveAspectRatio="none" style="width:836px;height:932px;" version="1.1" viewBox="0 0 836 932" width="836px" zoomAndPan="magnify"><defs><filter height="300%" id="f17iq6y0nedmqz" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#ADD8E6" height="917.6682" style="stroke: #A80036; stroke-width: 1.0;" width="350" x="458" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="124" x="571" y="17.897">Pod (Job Container)</text><rect fill="#FFFFFF" filter="url(#f17iq6y0nedmqz)" height="615.4143" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="491.5" y="199.186"/><rect fill="#FFFFFF" filter="url(#f17iq6y0nedmqz)" height="440.1782" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="748.5" y="374.4221"/><rect fill="#FFFFFF" filter="url(#f17iq6y0nedmqz)" height="95.118" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="753.5" y="636.0702"/><rect fill="#FFFFFF" filter="url(#f17iq6y0nedmqz)" height="146.5301" style="stroke: #000000; stroke-width: 2.0;" width="801" x="13" y="592.6582"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="45" x2="45" y1="89.0679" y2="832.6003"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="204" x2="204" y1="89.0679" y2="832.6003"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="496" x2="496" y1="89.0679" y2="832.6003"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="753" x2="753" y1="89.0679" y2="832.6003"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="23" y="84.9659">Client</text><ellipse cx="45.5" cy="13" fill="#FEFECE" filter="url(#f17iq6y0nedmqz)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M45.5,21 L45.5,48 M32.5,29 L58.5,29 M45.5,48 L32.5,63 M45.5,48 L58.5,63 " fill="none" filter="url(#f17iq6y0nedmqz)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="23" y="846.5662">Client</text><ellipse cx="45.5" cy="860.6682" fill="#FEFECE" filter="url(#f17iq6y0nedmqz)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M45.5,868.6682 L45.5,895.6682 M32.5,876.6682 L58.5,876.6682 M45.5,895.6682 L32.5,910.6682 M45.5,895.6682 L58.5,910.6682 " fill="none" filter="url(#f17iq6y0nedmqz)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f17iq6y0nedmqz)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="111" x="147" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="97" x="154" y="72.9659">Fallback Client</text><rect fill="#FEFECE" filter="url(#f17iq6y0nedmqz)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="111" x="147" y="831.6003"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="97" x="154" y="853.5662">Fallback Client</text><rect fill="#FEFECE" filter="url(#f17iq6y0nedmqz)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="65" x="462" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="51" x="469" y="72.9659">Process</text><rect fill="#FEFECE" filter="url(#f17iq6y0nedmqz)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="65" x="462" y="831.6003"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="51" x="469" y="853.5662">Process</text><rect fill="#FEFECE" filter="url(#f17iq6y0nedmqz)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="703" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="710" y="72.9659">Proxy Server</text><rect fill="#FEFECE" filter="url(#f17iq6y0nedmqz)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="703" y="831.6003"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="710" y="853.5662">Proxy Server</text><rect fill="#FFFFFF" filter="url(#f17iq6y0nedmqz)" height="615.4143" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="491.5" y="199.186"/><rect fill="#FFFFFF" filter="url(#f17iq6y0nedmqz)" height="440.1782" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="748.5" y="374.4221"/><rect fill="#FFFFFF" filter="url(#f17iq6y0nedmqz)" height="95.118" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="753.5" y="636.0702"/><polygon fill="#A80036" points="192.5,118.7739,202.5,122.7739,192.5,126.7739,196.5,122.7739" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="45.5" x2="198.5" y1="122.7739" y2="122.7739"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="52.5" y="116.9649">Request streaming job</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="204.5" x2="246.5" y1="154.4799" y2="154.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="246.5" x2="246.5" y1="154.4799" y2="167.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="205.5" x2="246.5" y1="167.4799" y2="167.4799"/><polygon fill="#A80036" points="215.5,163.4799,205.5,167.4799,215.5,171.4799,211.5,167.4799" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="211.5" y="148.6709">Generate client certificate</text><polygon fill="#A80036" points="479.5,195.186,489.5,199.186,479.5,203.186,483.5,199.186" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="204.5" x2="485.5" y1="199.186" y2="199.186"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="211.5" y="193.377">Request job</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501.5" x2="543.5" y1="230.892" y2="230.892"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543.5" x2="543.5" y1="230.892" y2="243.892"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502.5" x2="543.5" y1="243.892" y2="243.892"/><polygon fill="#A80036" points="512.5,239.892,502.5,243.892,512.5,247.892,508.5,243.892" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="508.5" y="225.083">Start job container</text><polygon fill="#A80036" points="215.5,271.598,205.5,275.598,215.5,279.598,211.5,275.598" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="209.5" x2="490.5" y1="275.598" y2="275.598"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="221.5" y="269.789">Container is ready</text><polygon fill="#A80036" points="479.5,303.304,489.5,307.304,479.5,311.304,483.5,307.304" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="204.5" x2="485.5" y1="307.304" y2="307.304"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="263" x="211.5" y="301.495">Upload client certificate (InlineInputVolume)</text><polygon fill="#A80036" points="736.5,370.4221,746.5,374.4221,736.5,378.4221,740.5,374.4221" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="501.5" x2="742.5" y1="374.4221" y2="374.4221"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="508.5" y="333.201">Install NGINX</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="508.5" y="350.907">Generate server certificate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="508.5" y="368.6131">Start proxy server (requires client cert)</text><polygon fill="#A80036" points="479.5,402.1281,489.5,406.1281,479.5,410.1281,483.5,406.1281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="204.5" x2="485.5" y1="406.1281" y2="406.1281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="211.5" y="400.3191">Poll for server certificate and address</text><polygon fill="#A80036" points="215.5,433.8341,205.5,437.8341,215.5,441.8341,211.5,437.8341" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="209.5" x2="490.5" y1="437.8341" y2="437.8341"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="257" x="221.5" y="432.0251">Return server public certificate and address</text><polygon fill="#A80036" points="56.5,483.2461,46.5,487.2461,56.5,491.2461,52.5,487.2461" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="50.5" x2="203.5" y1="487.2461" y2="487.2461"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="62.5" y="463.7311">Return server address</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="62.5" y="481.4371">and public certificate</text><rect fill="#EEEEEE" filter="url(#f17iq6y0nedmqz)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="821" x="3" y="517.0991"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="824" y1="517.0991" y2="517.0991"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="824" y1="520.0991" y2="520.0991"/><rect fill="#EEEEEE" filter="url(#f17iq6y0nedmqz)" height="25.706" style="stroke: #000000; stroke-width: 2.0;" width="125" x="351" y="505.2461"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="108" x="357" y="523.1431">Execution Phase</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501.5" x2="543.5" y1="564.6582" y2="564.6582"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543.5" x2="543.5" y1="564.6582" y2="577.6582"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502.5" x2="543.5" y1="577.6582" y2="577.6582"/><polygon fill="#A80036" points="512.5,573.6582,502.5,577.6582,512.5,581.6582,508.5,577.6582" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="508.5" y="558.8492">Actual work</text><path d="M13,592.6582 L86,592.6582 L86,601.6582 L76,611.6582 L13,611.6582 L13,592.6582 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="146.5301" style="stroke: #000000; stroke-width: 2.0;" width="801" x="13" y="592.6582"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="28" y="607.5552">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="263" x="101" y="606.4171">[Streaming until client finishes or job times out]</text><polygon fill="#A80036" points="741.5,632.0702,751.5,636.0702,741.5,640.0702,745.5,636.0702" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="45.5" x2="747.5" y1="636.0702" y2="636.0702"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="52.5" y="630.2612">Request (signed with client cert)</text><polygon fill="#A80036" points="512.5,663.7762,502.5,667.7762,512.5,671.7762,508.5,667.7762" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="506.5" x2="752.5" y1="667.7762" y2="667.7762"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="518.5" y="661.9672">Forward to unsafe HTTP app</text><polygon fill="#A80036" points="741.5,695.4822,751.5,699.4822,741.5,703.4822,745.5,699.4822" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="501.5" x2="747.5" y1="699.4822" y2="699.4822"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="508.5" y="693.6732">Response from app</text><polygon fill="#A80036" points="56.5,727.1882,46.5,731.1882,56.5,735.1882,52.5,731.1882" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="50.5" x2="747.5" y1="731.1882" y2="731.1882"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="62.5" y="725.3792">Response (signed with server cert)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501.5" x2="543.5" y1="769.8943" y2="769.8943"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543.5" x2="543.5" y1="769.8943" y2="782.8943"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502.5" x2="543.5" y1="782.8943" y2="782.8943"/><polygon fill="#A80036" points="512.5,778.8943,502.5,782.8943,512.5,786.8943,508.5,782.8943" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="508.5" y="764.0853">Serialize and upload artifacts</text><polygon fill="#A80036" points="56.5,810.6003,46.5,814.6003,56.5,818.6003,52.5,814.6003" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="50.5" x2="495.5" y1="814.6003" y2="814.6003"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="62.5" y="808.7913">Job finished</text><!--MD5=[3ab563f59eac7eac5de062212924678f]
@startuml
actor Client
participant "Fallback Client"
box "Pod (Job Container)" #LightBlue
  participant Process
  participant "Proxy Server"
end box

Client -> "Fallback Client": Request streaming job
"Fallback Client" -> "Fallback Client": Generate client certificate

"Fallback Client" -> Process: Request job
activate Process
Process -> Process: Start job container
Process -> "Fallback Client": Container is ready
"Fallback Client" -> Process: Upload client certificate (InlineInputVolume)

Process -> "Proxy Server": Install NGINX\nGenerate server certificate\nStart proxy server (requires client cert)
activate "Proxy Server"
"Fallback Client" -> Process: Poll for server certificate and address
Process -> "Fallback Client": Return server public certificate and address


"Fallback Client" -> Client: Return server address\nand public certificate

== Execution Phase ==
Process -> Process: Actual work
loop Streaming until client finishes or job times out
  Client -> "Proxy Server": Request (signed with client cert)
  activate "Proxy Server"
  "Proxy Server" - -> Process: Forward to unsafe HTTP app
  Process - -> "Proxy Server": Response from app
  "Proxy Server" -> Client: Response (signed with server cert)
  deactivate "Proxy Server"
end

Process -> Process: Serialize and upload artifacts

Process -> Client: Job finished
deactivate "Proxy Server"
deactivate Process

@enduml

PlantUML version 1.2020.02(Sun Mar 01 11:22:07 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 21.0.7+6-Ubuntu-0ubuntu124.04
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>