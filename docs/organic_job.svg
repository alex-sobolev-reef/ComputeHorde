<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="3631px" preserveAspectRatio="none" style="width:1839px;height:3631px;" version="1.1" viewBox="0 0 1839 3631" width="1839px" zoomAndPan="magnify"><defs><filter height="300%" id="fom9pjruhgppm" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFBB" height="3616.5358" style="stroke: #808080; stroke-width: 1.0;" width="92" x="42" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="68" x="52.5" y="17.897">Facilitator</text><rect fill="#EEF5FF" height="3616.5358" style="stroke: #808080; stroke-width: 1.0;" width="263.5" x="173" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="60" x="273.25" y="17.897">Validator</text><rect fill="#FFFFE0" height="3616.5358" style="stroke: #808080; stroke-width: 1.0;" width="342" x="494.5" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="644.5" y="17.897">Miner</text><rect fill="#EFEFEF" height="3616.5358" style="stroke: #808080; stroke-width: 1.0;" width="526.5" x="897" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="59" x="1129.25" y="17.897">Executor</text><rect fill="#FFFFFF" filter="url(#fom9pjruhgppm)" height="300.1788" style="stroke: #000000; stroke-width: 2.0;" width="702" x="72" y="615.2537"/><rect fill="#FFFFFF" filter="url(#fom9pjruhgppm)" height="378.3252" style="stroke: #000000; stroke-width: 2.0;" width="721.5" x="333.5" y="928.4325"/><rect fill="#FFFFFF" filter="url(#fom9pjruhgppm)" height="544.8559" style="stroke: #000000; stroke-width: 2.0;" width="1211" x="72" y="1319.7577"/><rect fill="#FFFFFF" filter="url(#fom9pjruhgppm)" height="188.2361" style="stroke: #000000; stroke-width: 2.0;" width="335" x="923" y="1620.5386"/><rect fill="#FFFFFF" filter="url(#fom9pjruhgppm)" height="378.4586" style="stroke: #000000; stroke-width: 2.0;" width="1519" x="72" y="2112.7096"/><rect fill="#FFFFFF" filter="url(#fom9pjruhgppm)" height="116.2509" style="stroke: #000000; stroke-width: 2.0;" width="1298" x="72" y="2504.1682"/><rect fill="#FFFFFF" filter="url(#fom9pjruhgppm)" height="280.7809" style="stroke: #000000; stroke-width: 2.0;" width="1738" x="72" y="2686.8311"/><rect fill="#FFFFFF" filter="url(#fom9pjruhgppm)" height="88.118" style="stroke: #000000; stroke-width: 2.0;" width="447" x="1338" y="2791.9492"/><rect fill="#FFFFFF" filter="url(#fom9pjruhgppm)" height="498.4438" style="stroke: #000000; stroke-width: 2.0;" width="1388.5" x="72" y="3034.0241"/><rect fill="#FFFFFF" filter="url(#fom9pjruhgppm)" height="101.118" style="stroke: #000000; stroke-width: 2.0;" width="512.5" x="923" y="3107.4361"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="88" x2="88" y1="63.7739" y2="128.4799"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="88" x2="88" y1="128.4799" y2="156.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="88" x2="88" y1="156.4799" y2="3576.4679"/><rect fill="#FFFFFF" filter="url(#fom9pjruhgppm)" height="33" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="83" y="95.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="83" x2="83" y1="95.4799" y2="128.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="93" x2="93" y1="95.4799" y2="128.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="83" x2="93" y1="95.4799" y2="95.4799"/><rect fill="#FFFFFF" filter="url(#fom9pjruhgppm)" height="3419.988" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="83" y="156.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="83" x2="83" y1="156.4799" y2="3576.4679"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="93" x2="93" y1="156.4799" y2="3576.4679"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="83" x2="93" y1="3576.4679" y2="3576.4679"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="258" x2="258" y1="63.7739" y2="128.4799"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="258" x2="258" y1="128.4799" y2="156.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="258" x2="258" y1="156.4799" y2="3576.4679"/><rect fill="#FFFFFF" filter="url(#fom9pjruhgppm)" height="3314.4431" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="253" y="227.0248"/><rect fill="#90EE90" filter="url(#fom9pjruhgppm)" height="3122.3534" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="258" y="363.2757"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="391" x2="391" y1="63.7739" y2="128.4799"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="391" x2="391" y1="128.4799" y2="156.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="391" x2="391" y1="156.4799" y2="3576.4679"/><rect fill="#FF9999" filter="url(#fom9pjruhgppm)" height="3083.7802" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="386" y="492.6877"/><rect fill="#90EE90" filter="url(#fom9pjruhgppm)" height="267.4728" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="391" y="639.9597"/><rect fill="#90EE90" filter="url(#fom9pjruhgppm)" height="903.4751" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="391" y="953.1385"/><rect fill="#AAAAEE" filter="url(#fom9pjruhgppm)" height="1394.6255" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="391" y="2055.2976"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="574" x2="574" y1="63.7739" y2="128.4799"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="574" x2="574" y1="128.4799" y2="156.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="574" x2="574" y1="156.4799" y2="3576.4679"/><rect fill="#FFFFFF" filter="url(#fom9pjruhgppm)" height="2897.8234" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="569" y="552.0997"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="758" x2="758" y1="63.7739" y2="128.4799"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="758" x2="758" y1="128.4799" y2="156.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="758" x2="758" y1="156.4799" y2="3576.4679"/><rect fill="#FFFFFF" filter="url(#fom9pjruhgppm)" height="2004.6353" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="753" y="1445.2878"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="939" x2="939" y1="63.7739" y2="128.4799"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="939" x2="939" y1="128.4799" y2="156.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="939" x2="939" y1="156.4799" y2="3576.4679"/><rect fill="#FF9999" filter="url(#fom9pjruhgppm)" height="2313.4163" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="934" y="1263.0517"/><rect fill="#90EE90" filter="url(#fom9pjruhgppm)" height="520.1499" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="939" y="1344.4637"/><rect fill="#AAAAEE" filter="url(#fom9pjruhgppm)" height="1440.0375" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="939" y="2001.8855"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1354" x2="1354" y1="63.7739" y2="128.4799"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1354" x2="1354" y1="128.4799" y2="156.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1354" x2="1354" y1="156.4799" y2="3576.4679"/><rect fill="#FFFFFF" filter="url(#fom9pjruhgppm)" height="177.5301" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1349" y="2258.7993"/><rect fill="#FFFFFF" filter="url(#fom9pjruhgppm)" height="31.706" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1349" y="3349.3782"/><rect fill="#FFFFFF" filter="url(#fom9pjruhgppm)" height="31.706" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1354" y="3317.6722"/><rect fill="#FFFFFF" filter="url(#fom9pjruhgppm)" height="76.412" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1359" y="3241.2602"/><rect fill="#FEFECE" filter="url(#fom9pjruhgppm)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="46" y="25.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="53" y="47.672">Facilitator</text><rect fill="#FEFECE" filter="url(#fom9pjruhgppm)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="158" x="177" y="25.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="144" x="184" y="47.672">Facilitator connection</text><rect fill="#FEFECE" filter="url(#fom9pjruhgppm)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="79" x="349.5" y="25.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="356.5" y="47.672">Job driver</text><rect fill="#FEFECE" filter="url(#fom9pjruhgppm)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="147" x="498.5" y="25.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="133" x="505.5" y="47.672">Validator Consumer</text><rect fill="#FEFECE" filter="url(#fom9pjruhgppm)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="145" x="683.5" y="25.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="131" x="690.5" y="47.672">Executor Consumer</text><rect fill="#FEFECE" filter="url(#fom9pjruhgppm)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="72" x="901" y="25.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="908" y="47.672">Executor</text><rect fill="#FEFECE" filter="url(#fom9pjruhgppm)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1288.5" y="25.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1295.5" y="47.672">Task/Subprocess</text><rect fill="#FEFECE" filter="url(#fom9pjruhgppm)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="46" y="3576.4679"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="53" y="3598.4339">Facilitator</text><rect fill="#FEFECE" filter="url(#fom9pjruhgppm)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="158" x="177" y="3576.4679"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="144" x="184" y="3598.4339">Facilitator connection</text><rect fill="#FEFECE" filter="url(#fom9pjruhgppm)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="79" x="349.5" y="3576.4679"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="356.5" y="3598.4339">Job driver</text><rect fill="#FEFECE" filter="url(#fom9pjruhgppm)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="147" x="498.5" y="3576.4679"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="133" x="505.5" y="3598.4339">Validator Consumer</text><rect fill="#FEFECE" filter="url(#fom9pjruhgppm)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="145" x="683.5" y="3576.4679"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="131" x="690.5" y="3598.4339">Executor Consumer</text><rect fill="#FEFECE" filter="url(#fom9pjruhgppm)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="72" x="901" y="3576.4679"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="908" y="3598.4339">Executor</text><rect fill="#FEFECE" filter="url(#fom9pjruhgppm)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1288.5" y="3576.4679"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1295.5" y="3598.4339">Task/Subprocess</text><polygon fill="#A80036" points="104,91.4799,94,95.4799,104,99.4799,100,95.4799" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="98" x2="257" y1="95.4799" y2="95.4799"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="110" y="89.6709">Connect</text><polygon fill="#A80036" points="71,193.892,81,197.892,71,201.892,75,197.892" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3" x2="77" y1="197.892" y2="197.892"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="10" y="174.377">Create job</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="40" x="10" y="192.083">(HTTP)</text><polygon fill="#A80036" points="241,223.0248,251,227.0248,241,231.0248,245,227.0248" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="93" x2="247" y1="227.0248" y2="227.0248"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="100" y="221.9589">V2JobRequest</text><polygon fill="#A80036" points="104,269.8636,94,273.8636,104,277.8636,100,273.8636" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="98" x2="252" y1="273.8636" y2="273.8636"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="110" y="251.0917">V0JobStatusUpdate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="110" y="268.0546">(Received)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="263" x2="305" y1="305.5696" y2="305.5696"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="305" x2="305" y1="305.5696" y2="318.5696"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="264" x2="305" y1="318.5696" y2="318.5696"/><polygon fill="#A80036" points="274,314.5696,264,318.5696,274,322.5696,270,318.5696" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="270" y="299.7606">Pick miner</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="263" x2="310" y1="350.2757" y2="350.2757"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="310" x2="310" y1="350.2757" y2="363.2757"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="269" x2="310" y1="363.2757" y2="363.2757"/><polygon fill="#A80036" points="279,359.2757,269,363.2757,279,367.2757,275,363.2757" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="275" y="344.4667">Submit celery task</text><rect fill="#90EE90" filter="url(#fom9pjruhgppm)" height="25" style="stroke: #A80036; stroke-width: 1.0;" width="131" x="273" y="376.2757"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="277" y="394.1727">celery result timeout</text><rect fill="#FBFB77" filter="url(#fom9pjruhgppm)" height="25" style="stroke: #A80036; stroke-width: 1.0;" width="245" x="201.75" y="436.9817"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="235" y="454.8787">Waiting for celery task to start</text><rect fill="#FF9999" filter="url(#fom9pjruhgppm)" height="25" style="stroke: #A80036; stroke-width: 1.0;" width="95" x="401" y="497.6877"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="405" y="515.5847">celery task TTL</text><polygon fill="#A80036" points="557,548.0997,567,552.0997,557,556.0997,561,552.0997" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="563" y1="552.0997" y2="552.0997"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="403" y="546.2907">Connect</text><rect fill="#EEEEEE" filter="url(#fom9pjruhgppm)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1816" x="3" y="584.6767"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1819" y1="584.6767" y2="584.6767"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1819" y1="587.6767" y2="587.6767"/><rect fill="#EEEEEE" filter="url(#fom9pjruhgppm)" height="31.1539" style="stroke: #000000; stroke-width: 2.0;" width="116" x="853" y="570.0997"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="102" x="859" y="592.2727">Preparation</text><path d="M72,615.2537 L235,615.2537 L235,624.2537 L225,634.2537 L72,634.2537 L72,615.2537 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="300.1788" style="stroke: #000000; stroke-width: 2.0;" width="702" x="72" y="615.2537"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="87" y="630.1507">Reservation stage</text><rect fill="#90EE90" filter="url(#fom9pjruhgppm)" height="61" style="stroke: #A80036; stroke-width: 1.0;" width="152" x="406" y="644.9597"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="410" y="662.8567">Timeout:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="144" x="410" y="680.5627">reservation time limit</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="410" y="698.2687">(dynamic config)</text><polygon fill="#A80036" points="557,781.3286,567,785.3286,557,789.3286,561,785.3286" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="401" x2="563" y1="785.3286" y2="785.3286"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="408" y="727.1446">V0InitialJobRequest</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="408" y="744.1076">-</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="415" y="744.8506">JobStartedReceipt</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="408" y="761.8136">- Executor class</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="408" y="779.5196">- Job timing</text><path d="M584,751.7696 L584,814.7696 L745,814.7696 L745,761.7696 L735,751.7696 L584,751.7696 " fill="#FBFB77" filter="url(#fom9pjruhgppm)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M735,751.7696 L735,761.7696 L745,761.7696 L735,751.7696 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="590" y="770.6666">This is essentially a dual</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="590" y="788.3726">reserve+start executor</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="590" y="806.0786">request in one</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="579" x2="621" y1="847.5936" y2="847.5936"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="621" x2="621" y1="847.5936" y2="860.5936"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="580" x2="621" y1="860.5936" y2="860.5936"/><polygon fill="#A80036" points="590,856.5936,580,860.5936,590,864.5936,586,860.5936" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="586" y="841.7846">Reserve executor from pool</text><polygon fill="#A80036" points="412,903.4325,402,907.4325,412,911.4325,408,907.4325" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="406" x2="568" y1="907.4325" y2="907.4325"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="418" y="902.3666">V0AcceptJobRequest</text><polygon fill="#A80036" points="104,903.4325,94,907.4325,104,911.4325,100,907.4325" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="98" x2="385" y1="907.4325" y2="907.4325"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="110" y="884.6605">V0JobStatusUpdate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63" x="110" y="901.6235">(Accepted)</text><path d="M333.5,928.4325 L462.5,928.4325 L462.5,937.4325 L452.5,947.4325 L333.5,947.4325 L333.5,928.4325 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="378.3252" style="stroke: #000000; stroke-width: 2.0;" width="721.5" x="333.5" y="928.4325"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="84" x="348.5" y="943.3295">Spinup stage</text><rect fill="#90EE90" filter="url(#fom9pjruhgppm)" height="96" style="stroke: #A80036; stroke-width: 1.0;" width="149" x="406" y="963.9915"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="410" y="981.8885">Timeout:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="141" x="410" y="999.5945">executor class spinup</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="410" y="1017.3005">(depends on class)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7" x="410" y="1035.0066">+</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="117" x="420" y="1035.0066">startup time limit</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="410" y="1052.7126">(dynamic config)</text><polygon fill="#A80036" points="927,1008.2565,937,1012.2565,927,1016.2565,931,1012.2565" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="579" x2="933" y1="1012.2565" y2="1012.2565"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="586" y="971.0355">Start executor</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="586" y="988.7415">(via vendor code)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="297" x="586" y="1006.4475">(pass executor TTL to deal with zombie executors)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="939" x2="981" y1="1089.2276" y2="1089.2276"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="981" x2="981" y1="1089.2276" y2="1102.2276"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="940" x2="981" y1="1102.2276" y2="1102.2276"/><polygon fill="#A80036" points="950,1098.2276,940,1102.2276,950,1106.2276,946,1102.2276" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="9" x="946" y="1083.4186">...</text><rect fill="#FBFB77" filter="url(#fom9pjruhgppm)" height="25" style="stroke: #A80036; stroke-width: 1.0;" width="617" x="356.25" y="1115.2276"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="582" y="1133.1246">Waiting for executor spinup</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="939" x2="981" y1="1169.6396" y2="1169.6396"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="981" x2="981" y1="1169.6396" y2="1182.6396"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="940" x2="981" y1="1182.6396" y2="1182.6396"/><polygon fill="#A80036" points="950,1178.6396,940,1182.6396,950,1186.6396,946,1182.6396" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="9" x="946" y="1163.8306">...</text><rect fill="#FBFB77" filter="url(#fom9pjruhgppm)" height="25" style="stroke: #A80036; stroke-width: 1.0;" width="617" x="356.25" y="1195.6396"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="330" x="500" y="1213.5366">Always-on executors need a couple of seconds here too</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="939" x2="986" y1="1250.0517" y2="1250.0517"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="986" x2="986" y1="1250.0517" y2="1263.0517"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="945" x2="986" y1="1263.0517" y2="1263.0517"/><polygon fill="#A80036" points="955,1259.0517,945,1263.0517,955,1267.0517,951,1263.0517" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="9" x="951" y="1244.2427">...</text><rect fill="#FF9999" filter="url(#fom9pjruhgppm)" height="25" style="stroke: #A80036; stroke-width: 1.0;" width="85" x="949" y="1276.0517"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="953" y="1293.9487">executor TTL</text><path d="M72,1319.7577 L206,1319.7577 L206,1328.7577 L196,1338.7577 L72,1338.7577 L72,1319.7577 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="544.8559" style="stroke: #000000; stroke-width: 2.0;" width="1211" x="72" y="1319.7577"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="89" x="87" y="1334.6547">Startup stage</text><rect fill="#90EE90" filter="url(#fom9pjruhgppm)" height="43" style="stroke: #A80036; stroke-width: 1.0;" width="125" x="954" y="1361.3167"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="958" y="1379.2137">Timeout:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="117" x="958" y="1396.9197">startup time limit</text><path d="M726,1349.4637 L726,1412.4637 L930,1412.4637 L930,1359.4637 L920,1349.4637 L726,1349.4637 " fill="#FBFB77" filter="url(#fom9pjruhgppm)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M920,1349.4637 L920,1359.4637 L930,1359.4637 L920,1349.4637 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="732" y="1368.3607">Startup time is constant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="732" y="1386.0667">unless we want to allow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="732" y="1403.7727">heavy volume downloads here</text><polygon fill="#A80036" points="774,1441.2878,764,1445.2878,774,1449.2878,770,1445.2878" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="768" x2="933" y1="1445.2878" y2="1445.2878"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="780" y="1439.4788">Connect</text><polygon fill="#A80036" points="927,1470.4206,937,1474.4206,927,1478.4206,931,1474.4206" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="763" x2="933" y1="1474.4206" y2="1474.4206"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="770" y="1469.3547">V0InitialJobRequest</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="949" x2="991" y1="1506.1266" y2="1506.1266"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="991" x2="991" y1="1506.1266" y2="1519.1266"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="950" x2="991" y1="1519.1266" y2="1519.1266"/><polygon fill="#A80036" points="960,1515.1266,950,1519.1266,960,1523.1266,956,1519.1266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="956" y="1500.3176">CVE check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="949" x2="991" y1="1550.8326" y2="1550.8326"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="991" x2="991" y1="1550.8326" y2="1563.8326"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="950" x2="991" y1="1563.8326" y2="1563.8326"/><polygon fill="#A80036" points="960,1559.8326,950,1563.8326,960,1567.8326,956,1563.8326" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="956" y="1545.0236">toolkit ver. check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="949" x2="991" y1="1595.5386" y2="1595.5386"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="991" x2="991" y1="1595.5386" y2="1608.5386"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="950" x2="991" y1="1608.5386" y2="1608.5386"/><polygon fill="#A80036" points="960,1604.5386,950,1608.5386,960,1612.5386,956,1608.5386" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="956" y="1589.7296">clear old jobs</text><path d="M923,1620.5386 L1168,1620.5386 L1168,1629.5386 L1158,1639.5386 L923,1639.5386 L923,1620.5386 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="188.2361" style="stroke: #000000; stroke-width: 2.0;" width="335" x="923" y="1620.5386"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="200" x="938" y="1635.4356">docker image in initial details?</text><path d="M954,1650.2446 L954,1713.2446 L1233,1713.2446 L1233,1660.2446 L1223,1650.2446 L954,1650.2446 " fill="#FBFB77" filter="url(#fom9pjruhgppm)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1223,1650.2446 L1223,1660.2446 L1233,1660.2446 L1223,1650.2446 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="221" x="960" y="1669.1416">this is only for small images, large job</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="960" y="1686.8477">images must be preloaded somewhere else</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="960" y="1704.5537">or this takes too long</text><path d="M954,1727.3627 L954,1754.3627 L1218,1754.3627 L1218,1737.3627 L1208,1727.3627 L954,1727.3627 " fill="#FBFB77" filter="url(#fom9pjruhgppm)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1208,1727.3627 L1208,1737.3627 L1218,1737.3627 L1208,1727.3627 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="960" y="1746.2597">if image is preloaded, this will exit quickly</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="949" x2="991" y1="1787.7747" y2="1787.7747"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="991" x2="991" y1="1787.7747" y2="1800.7747"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="950" x2="991" y1="1800.7747" y2="1800.7747"/><polygon fill="#A80036" points="960,1796.7747,950,1800.7747,960,1804.7747,956,1800.7747" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="956" y="1781.9657">pull docker image</text><polygon fill="#A80036" points="412,1852.6135,402,1856.6135,412,1860.6135,408,1856.6135" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="406" x2="933" y1="1856.6135" y2="1856.6135"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="418" y="1851.5476">V0ExecutorReadyRequest</text><polygon fill="#A80036" points="104,1852.6135,94,1856.6135,104,1860.6135,100,1856.6135" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="98" x2="385" y1="1856.6135" y2="1856.6135"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="110" y="1833.8416">V0JobStatusUpdate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="110" y="1850.8045">(Executor ready)</text><rect fill="#EEEEEE" filter="url(#fom9pjruhgppm)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1816" x="3" y="1898.1905"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1819" y1="1898.1905" y2="1898.1905"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1819" y1="1901.1905" y2="1901.1905"/><rect fill="#EEEEEE" filter="url(#fom9pjruhgppm)" height="31.1539" style="stroke: #000000; stroke-width: 2.0;" width="130" x="846" y="1883.6135"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="116" x="852" y="1905.7865">Job execution</text><path d="M356.25,1929.7675 L356.25,1992.7675 L973.25,1992.7675 L973.25,1939.7675 L963.25,1929.7675 L356.25,1929.7675 " fill="#FBFB77" filter="url(#fom9pjruhgppm)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M963.25,1929.7675 L963.25,1939.7675 L973.25,1939.7675 L963.25,1929.7675 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="402" x="378.5" y="1948.6645">It's important for both parties to start the deadline timer right here.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="477" x="378.5" y="1966.3705">In practice, the validator will start its timer a bit later than executor - this is good,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="560" x="378.5" y="1984.0765">as the validator is then less likely to time out before the executor. (unless the executor is dead)</text><rect fill="#AAAAEE" filter="url(#fom9pjruhgppm)" height="43" style="stroke: #A80036; stroke-width: 1.0;" width="84" x="954" y="2006.8855"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="958" y="2024.7826">Set deadline:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="958" y="2042.4886">leeway</text><rect fill="#AAAAEE" filter="url(#fom9pjruhgppm)" height="43" style="stroke: #A80036; stroke-width: 1.0;" width="84" x="406" y="2060.2976"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="410" y="2078.1946">Set deadline:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="410" y="2095.9006">leeway</text><path d="M72,2112.7096 L222,2112.7096 L222,2121.7096 L212,2131.7096 L72,2131.7096 L72,2112.7096 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="378.4586" style="stroke: #000000; stroke-width: 2.0;" width="1519" x="72" y="2112.7096"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="105" x="87" y="2127.6066">Download stage</text><rect fill="#AAAAEE" filter="url(#fom9pjruhgppm)" height="43" style="stroke: #A80036; stroke-width: 1.0;" width="140" x="406" y="2142.4156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="410" y="2160.3126">Extend deadline:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="132" x="410" y="2178.0187">download time limit</text><rect fill="#AAAAEE" filter="url(#fom9pjruhgppm)" height="43" style="stroke: #A80036; stroke-width: 1.0;" width="140" x="954" y="2142.4156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="958" y="2160.3126">Extend deadline:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="132" x="958" y="2178.0187">download time limit</text><polygon fill="#A80036" points="927,2225.6665,937,2229.6665,927,2233.6665,931,2229.6665" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="401" x2="933" y1="2229.6665" y2="2229.6665"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="408" y="2206.8946">V0JobRequest</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="408" y="2223.8575">- Job volumes</text><polygon fill="#A80036" points="1337,2254.7993,1347,2258.7993,1337,2262.7993,1341,2258.7993" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="949" x2="1343" y1="2258.7993" y2="2258.7993"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="956" y="2253.7334">unpack_volume()</text><path d="M1364,2271.7993 L1364,2316.7993 L1537,2316.7993 L1537,2281.7993 L1527,2271.7993 L1364,2271.7993 " fill="#FBFB77" filter="url(#fom9pjruhgppm)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1527,2271.7993 L1527,2281.7993 L1537,2281.7993 L1527,2271.7993 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="1370" y="2290.6963">Implementation depends</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="1370" y="2308.4023">on volume type</text><path d="M1364,2331.2113 L1364,2358.2113 L1566,2358.2113 L1566,2341.2113 L1556,2331.2113 L1364,2331.2113 " fill="#FBFB77" filter="url(#fom9pjruhgppm)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1556,2331.2113 L1556,2341.2113 L1566,2341.2113 L1556,2331.2113 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="1370" y="2350.1083">Multi volume does a loop here</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1359" x2="1401" y1="2391.6234" y2="2391.6234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1401" x2="1401" y1="2391.6234" y2="2404.6234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1360" x2="1401" y1="2404.6234" y2="2404.6234"/><polygon fill="#A80036" points="1370,2400.6234,1360,2404.6234,1370,2408.6234,1366,2404.6234" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="66" x="1366" y="2385.8144">Download</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="1435" y="2385.8144">+ unpack</text><polygon fill="#A80036" points="960,2432.3294,950,2436.3294,960,2440.3294,956,2436.3294" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="954" x2="1348" y1="2436.3294" y2="2436.3294"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="966" y="2430.5204">done</text><polygon fill="#A80036" points="412,2479.1682,402,2483.1682,412,2487.1682,408,2483.1682" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="406" x2="933" y1="2483.1682" y2="2483.1682"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="418" y="2477.3592">V0VolumesReady</text><polygon fill="#A80036" points="104,2479.1682,94,2483.1682,104,2487.1682,100,2483.1682" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="98" x2="385" y1="2483.1682" y2="2483.1682"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="110" y="2460.3963">V0JobStatusUpdate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="110" y="2477.3592">(Volumes ready)</text><path d="M72,2504.1682 L260,2504.1682 L260,2513.1682 L250,2523.1682 L72,2523.1682 L72,2504.1682 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="116.2509" style="stroke: #000000; stroke-width: 2.0;" width="1298" x="72" y="2504.1682"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="143" x="87" y="2519.0652">Start streaming stage</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="949" x2="991" y1="2552.5802" y2="2552.5802"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="991" x2="991" y1="2552.5802" y2="2565.5802"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="950" x2="991" y1="2565.5802" y2="2565.5802"/><polygon fill="#A80036" points="960,2561.5802,950,2565.5802,960,2569.5802,956,2565.5802" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="391" x="956" y="2546.7712">"Generate streaming server certificate and start streaming server"</text><polygon fill="#A80036" points="412,2608.4191,402,2612.4191,412,2616.4191,408,2612.4191" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="406" x2="933" y1="2612.4191" y2="2612.4191"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="418" y="2589.6471">V0StreamingJobReady</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="221" x="418" y="2606.6101">(server address and public certificate)</text><polygon fill="#A80036" points="104,2608.4191,94,2612.4191,104,2616.4191,100,2612.4191" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="98" x2="385" y1="2612.4191" y2="2612.4191"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="110" y="2589.6471">V0JobStatusUpdate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="110" y="2606.6101">(Streaming ready)</text><rect fill="#AAAAEE" filter="url(#fom9pjruhgppm)" height="43" style="stroke: #A80036; stroke-width: 1.0;" width="143" x="406" y="2634.4191"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="410" y="2652.3161">Extend deadline:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="135" x="410" y="2670.0221">execution time limit</text><rect fill="#AAAAEE" filter="url(#fom9pjruhgppm)" height="43" style="stroke: #A80036; stroke-width: 1.0;" width="143" x="954" y="2634.4191"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="958" y="2652.3161">Extend deadline:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="135" x="958" y="2670.0221">execution time limit</text><path d="M72,2686.8311 L222,2686.8311 L222,2695.8311 L212,2705.8311 L72,2705.8311 L72,2686.8311 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="280.7809" style="stroke: #000000; stroke-width: 2.0;" width="1738" x="72" y="2686.8311"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="105" x="87" y="2701.7281">Execution stage</text><polygon fill="#A80036" points="1342,2731.2431,1352,2735.2431,1342,2739.2431,1346,2735.2431" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="949" x2="1348" y1="2735.2431" y2="2735.2431"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="956" y="2729.4341">docker run</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1354" x2="1396" y1="2766.9492" y2="2766.9492"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1396" x2="1396" y1="2766.9492" y2="2779.9492"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1355" x2="1396" y1="2779.9492" y2="2779.9492"/><polygon fill="#A80036" points="1365,2775.9492,1355,2779.9492,1365,2783.9492,1361,2779.9492" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="1361" y="2761.1402">Actual work</text><path d="M1338,2791.9492 L1411,2791.9492 L1411,2800.9492 L1401,2810.9492 L1338,2810.9492 L1338,2791.9492 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="88.118" style="stroke: #000000; stroke-width: 2.0;" width="447" x="1338" y="2791.9492"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="1353" y="2806.8462">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="343" x="1426" y="2805.7081">[streaming - until client terminates the job or timeout occurs]</text><polygon fill="#A80036" points="1365,2836.3612,1355,2840.3612,1365,2844.3612,1361,2840.3612" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1359" x2="1818" y1="2840.3612" y2="2840.3612"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="1371" y="2834.5522">Requests are signed using</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="110" x="1530" y="2834.5522">client certificate</text><polygon fill="#A80036" points="1807,2868.0672,1817,2872.0672,1807,2876.0672,1811,2872.0672" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1354" x2="1813" y1="2872.0672" y2="2872.0672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="1361" y="2866.2582">Responses are signed using</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="92" x="1529" y="2866.2582">job certificate</text><polygon fill="#A80036" points="960,2908.7732,950,2912.7732,960,2916.7732,956,2912.7732" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="954" x2="1353" y1="2912.7732" y2="2912.7732"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="966" y="2906.9642">stdout, stderr</text><polygon fill="#A80036" points="412,2955.6121,402,2959.6121,412,2963.6121,408,2959.6121" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="406" x2="933" y1="2959.6121" y2="2959.6121"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="418" y="2953.803">V0ExecutionDone</text><polygon fill="#A80036" points="104,2955.6121,94,2959.6121,104,2963.6121,100,2959.6121" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="98" x2="385" y1="2959.6121" y2="2959.6121"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="110" y="2936.8401">V0JobStatusUpdate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="110" y="2953.803">(Execution done)</text><rect fill="#AAAAEE" filter="url(#fom9pjruhgppm)" height="43" style="stroke: #A80036; stroke-width: 1.0;" width="121" x="406" y="2981.6121"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="410" y="2999.5091">Extend deadline:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="113" x="410" y="3017.2151">upload time limit</text><rect fill="#AAAAEE" filter="url(#fom9pjruhgppm)" height="43" style="stroke: #A80036; stroke-width: 1.0;" width="121" x="954" y="2981.6121"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="958" y="2999.5091">Extend deadline:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="113" x="958" y="3017.2151">upload time limit</text><path d="M72,3034.0241 L202,3034.0241 L202,3043.0241 L192,3053.0241 L72,3053.0241 L72,3034.0241 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="498.4438" style="stroke: #000000; stroke-width: 2.0;" width="1388.5" x="72" y="3034.0241"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="85" x="87" y="3048.9211">Upload stage</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="949" x2="991" y1="3082.4361" y2="3082.4361"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="991" x2="991" y1="3082.4361" y2="3095.4361"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="950" x2="991" y1="3095.4361" y2="3095.4361"/><polygon fill="#A80036" points="960,3091.4361,950,3095.4361,960,3099.4361,956,3095.4361" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="956" y="3076.6271">Serialize artifacts</text><path d="M923,3107.4361 L996,3107.4361 L996,3116.4361 L986,3126.4361 L923,3126.4361 L923,3107.4361 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="101.118" style="stroke: #000000; stroke-width: 2.0;" width="512.5" x="923" y="3107.4361"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="938" y="3122.3331">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="4" x="1011" y="3121.195">[</text><text fill="#000000" font-family="monospace" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="175" x="1015" y="3121.8238">MultiUploadOutputUploader</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="4" x="1190" y="3121.195">]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="949" x2="991" y1="3155.8482" y2="3155.8482"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="991" x2="991" y1="3155.8482" y2="3168.8482"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="950" x2="991" y1="3168.8482" y2="3168.8482"/><polygon fill="#A80036" points="960,3164.8482,950,3168.8482,960,3172.8482,956,3168.8482" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="956" y="3150.0391">Zip the volume</text><polygon fill="#A80036" points="1342,3196.5542,1352,3200.5542,1342,3204.5542,1346,3200.5542" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="949" x2="1348" y1="3200.5542" y2="3200.5542"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="74" x="956" y="3194.7452">Start upload</text><polygon fill="#A80036" points="1347,3237.2602,1357,3241.2602,1347,3245.2602,1351,3241.2602" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="949" x2="1353" y1="3241.2602" y2="3241.2602"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="956" y="3235.4512">Upload stdout/stderr</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="949" x2="991" y1="3272.9662" y2="3272.9662"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="991" x2="991" y1="3272.9662" y2="3285.9662"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="950" x2="991" y1="3285.9662" y2="3285.9662"/><polygon fill="#A80036" points="960,3281.9662,950,3285.9662,960,3289.9662,956,3285.9662" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="956" y="3267.1572">await upload tasks</text><polygon fill="#A80036" points="960,3313.6722,950,3317.6722,960,3321.6722,956,3317.6722" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="954" x2="1348" y1="3317.6722" y2="3317.6722"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="966" y="3311.8632">Upload done</text><polygon fill="#A80036" points="960,3345.3782,950,3349.3782,960,3353.3782,956,3349.3782" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="954" x2="1348" y1="3349.3782" y2="3349.3782"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="966" y="3343.5692">Upload done</text><polygon fill="#A80036" points="960,3377.0843,950,3381.0843,960,3385.0843,956,3381.0843" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="954" x2="1348" y1="3381.0843" y2="3381.0843"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="966" y="3375.2752">Upload done</text><polygon fill="#A80036" points="960,3408.7903,950,3412.7903,960,3416.7903,956,3412.7903" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="954" x2="1353" y1="3412.7903" y2="3412.7903"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="966" y="3406.9813">Upload done</text><polygon fill="#A80036" points="412,3437.9231,402,3441.9231,412,3445.9231,408,3441.9231" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="406" x2="933" y1="3441.9231" y2="3441.9231"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="418" y="3436.8572">V0JobFinished</text><rect fill="#FBFB77" filter="url(#fom9pjruhgppm)" height="25" style="stroke: #A80036; stroke-width: 1.0;" width="177" x="169.5" y="3454.9231"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="173.5" y="3472.8201">Waiting for celery task result</text><polygon fill="#A80036" points="104,3520.4679,94,3524.4679,104,3528.4679,100,3524.4679" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="98" x2="252" y1="3524.4679" y2="3524.4679"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="110" y="3501.696">V0JobStatusUpdate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="110" y="3518.6589">(Complete)</text><!--MD5=[a4562d8b9b5127e3af2ca46431b2e696]
@startuml
!pragma teoz true
skinparam sequenceBoxBorderColor #gray
box Facilitator #ffb
participant Facilitator
end box
box Validator #eef5ff
participant "Facilitator connection"
participant "Job driver"
end box
box Miner #lightyellow
participant "Validator Consumer"
participant "Executor Consumer"
end box
box Executor #efefef
participant Executor
participant "Task/Subprocess"
end box

"Facilitator connection" -> Facilitator: Connect
activate Facilitator
|||
...

-> Facilitator: Create job\n(HTTP)
Facilitator -> "Facilitator connection": ""V2JobRequest""
activate "Facilitator connection"
"Facilitator connection" -> Facilitator: ""V0JobStatusUpdate""\n(Received)

"Facilitator connection" -> "Facilitator connection": Pick miner
"Facilitator connection" -> "Facilitator connection": Submit celery task
activate "Facilitator connection" #lightgreen
rnote right of "Facilitator connection" #lightgreen: celery result timeout
|||
rnote over "Facilitator connection", "Job driver": Waiting for celery task to start
|||
activate "Job driver" #f99
rnote right of "Job driver" #f99: celery task TTL
"Job driver" -> "Validator Consumer": Connect
activate "Validator Consumer"


== =Preparation ==

group Reservation stage
activate "Job driver" #lightgreen
rnote right of "Job driver" #lightgreen: Timeout:\n**reservation time limit**\n(dynamic config)
"Job driver" -> "Validator Consumer": ""V0InitialJobRequest""\n- ""JobStartedReceipt""\n- Executor class\n- Job timing
&note right of "Validator Consumer": This is essentially a dual\nreserve+start executor\nrequest in one
"Validator Consumer" -> "Validator Consumer": Reserve executor from pool
"Validator Consumer" -> "Job driver": ""V0AcceptJobRequest""
&"Job driver" -> Facilitator: ""V0JobStatusUpdate""\n(Accepted)
deactivate "Job driver"
end group

group Spinup stage
activate "Job driver" #lightgreen
rnote right of "Job driver" #lightgreen: Timeout:\n**executor class spinup**\n(depends on class)\n+ **startup time limit**\n(dynamic config)
&"Validator Consumer" - -> Executor: Start executor\n(via vendor code)\n(pass executor TTL to deal with zombie executors)
Executor -> Executor: ...
rnote over "Job driver", Executor: Waiting for executor spinup
Executor -> Executor: ...
rnote over "Job driver", Executor: Always-on executors need a couple of seconds here too
Executor -> Executor: ...

activate Executor #f99
rnote right of Executor #f99: executor TTL
end group

group Startup stage
activate Executor #lightgreen
rnote right of "Executor" #lightgreen: Timeout:\n**startup time limit**
&note left of "Executor": Startup time is constant\nunless we want to allow\nheavy volume downloads here

Executor -> "Executor Consumer": Connect
activate "Executor Consumer"
"Executor Consumer" -> Executor: ""V0InitialJobRequest""
Executor -> "Executor": CVE check
Executor -> "Executor": toolkit ver. check
Executor -> Executor: clear old jobs
group docker image in initial details?
note right of Executor: this is only for small images, large job\nimages must be preloaded somewhere else\nor this takes too long
note right of Executor: if image is preloaded, this will exit quickly
Executor -> Executor: pull docker image
end group
Executor -> "Job driver": ""V0ExecutorReadyRequest""
&"Job driver" -> Facilitator: ""V0JobStatusUpdate""\n(Executor ready)
deactivate "Job driver"
deactivate Executor
end group

== =Job execution ==
note over "Job driver", "Executor": It's important for both parties to start the deadline timer right here.\nIn practice, the validator will start its timer a bit later than executor - this is good,\nas the validator is then less likely to time out before the executor. (unless the executor is dead)

activate Executor #aae
rnote right of Executor #aae: Set deadline:\n**leeway**
activate "Job driver" #aae
rnote right of "Job driver" #aae: Set deadline:\n**leeway**
group Download stage
rnote right of "Job driver" #aae: Extend deadline:\n**download time limit**
&rnote right of Executor #aae: Extend deadline:\n**download time limit**

"Job driver" -> "Executor": ""V0JobRequest""\n- Job volumes
Executor -> "Task/Subprocess": ""unpack_volume()""
activate "Task/Subprocess"
note right of "Task/Subprocess": Implementation depends\non volume type
note right of "Task/Subprocess": Multi volume does a loop here
"Task/Subprocess" -> "Task/Subprocess": **Download** + unpack
return done
deactivate "Task/Subprocess"
"Executor" -> "Job driver": V0VolumesReady
&"Job driver" -> Facilitator: ""V0JobStatusUpdate""\n(Volumes ready)
end group

group Start streaming stage
Executor -> Executor: "Generate streaming server certificate and start streaming server"
"Executor" -> "Job driver": ""V0StreamingJobReady""\n(server address and public certificate)
&"Job driver" -> Facilitator: ""V0JobStatusUpdate""\n(Streaming ready)
end group

rnote right of "Job driver" #aae: Extend deadline:\n**execution time limit**
&rnote right of Executor #aae: Extend deadline:\n**execution time limit**
group Execution stage

Executor - -> "Task/Subprocess": docker run
activate "Task/Subprocess"
"Task/Subprocess" -> "Task/Subprocess": Actual work
loop streaming - until client terminates the job or timeout occurs
"Task/Subprocess"<-: Requests are signed using **client certificate**
"Task/Subprocess"->: Responses are signed using **job certificate**
end
"Task/Subprocess" -> Executor: stdout, stderr
deactivate "Task/Subprocess"

"Executor" -> "Job driver": V0ExecutionDone
&"Job driver" -> Facilitator: ""V0JobStatusUpdate""\n(Execution done)
end group

rnote right of "Job driver" #aae: Extend deadline:\n**upload time limit**
&rnote right of Executor #aae: Extend deadline:\n**upload time limit**
group Upload stage

Executor -> Executor: Serialize artifacts
loop ""MultiUploadOutputUploader""
Executor -> Executor: Zip the volume
Executor -> "Task/Subprocess": Start upload
activate "Task/Subprocess"
activate "Task/Subprocess"
activate "Task/Subprocess"
end loop
Executor -> "Task/Subprocess": Upload stdout/stderr
activate "Task/Subprocess"
Executor -> Executor: await upload tasks
"Task/Subprocess" - -> Executor: Upload done
deactivate "Task/Subprocess"
"Task/Subprocess" - -> Executor: Upload done
deactivate "Task/Subprocess"
"Task/Subprocess" - -> Executor: Upload done
deactivate "Task/Subprocess"
"Task/Subprocess" - -> Executor: Upload done
deactivate "Task/Subprocess"
Executor -> "Job driver": ""V0JobFinished""
deactivate Executor
deactivate "Job driver"

deactivate "Executor Consumer"
deactivate "Validator Consumer"
deactivate "Job driver"
deactivate Executor

rnote over "Facilitator connection": Waiting for celery task result
deactivate "Facilitator connection"
"Facilitator connection" -> Facilitator: ""V0JobStatusUpdate""\n(Complete)
end group

deactivate "Facilitator connection"
|||
@enduml

PlantUML version 1.2020.02(Sun Mar 01 10:22:07 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 21.0.7+6-Ubuntu-0ubuntu124.04
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>