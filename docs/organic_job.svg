<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="3684px" preserveAspectRatio="none" style="width:1769px;height:3684px;" version="1.1" viewBox="0 0 1769 3684" width="1769px" zoomAndPan="magnify"><defs><filter height="300%" id="fv5e5zzx7z3u7" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFBB" height="3669.9766" style="stroke: #808080; stroke-width: 1.0;" width="91" x="47.5" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="74" x="53.5" y="16.0669">Facilitator</text><rect fill="#EEF5FF" height="3669.9766" style="stroke: #808080; stroke-width: 1.0;" width="274" x="176.5" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="67" x="277.5" y="16.0669">Validator</text><rect fill="#FFFFE0" height="3669.9766" style="stroke: #808080; stroke-width: 1.0;" width="357" x="508.5" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="41" x="664" y="16.0669">Miner</text><rect fill="#EFEFEF" height="3669.9766" style="stroke: #808080; stroke-width: 1.0;" width="381" x="921.5" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="64" x="1077.5" y="16.0669">Executor</text><rect fill="#FFFFFF" filter="url(#fv5e5zzx7z3u7)" height="273.1602" style="stroke: #000000; stroke-width: 2.0;" width="723" x="77" y="580.8125"/><rect fill="#FFFFFF" filter="url(#fv5e5zzx7z3u7)" height="346.1602" style="stroke: #000000; stroke-width: 2.0;" width="735.5" x="349.5" y="866.9727"/><rect fill="#FFFFFF" filter="url(#fv5e5zzx7z3u7)" height="506.2578" style="stroke: #000000; stroke-width: 2.0;" width="1254" x="77" y="1226.1328"/><rect fill="#FFFFFF" filter="url(#fv5e5zzx7z3u7)" height="172.7969" style="stroke: #000000; stroke-width: 2.0;" width="357" x="949" y="1506.3281"/><rect fill="#FFFFFF" filter="url(#fv5e5zzx7z3u7)" height="352.7266" style="stroke: #000000; stroke-width: 2.0;" width="1400" x="77" y="2001.2422"/><rect fill="#FFFFFF" filter="url(#fv5e5zzx7z3u7)" height="156.7969" style="stroke: #000000; stroke-width: 2.0;" width="1122" x="77" y="2366.9688"/><rect fill="#FFFFFF" filter="url(#fv5e5zzx7z3u7)" height="477.3906" style="stroke: #000000; stroke-width: 2.0;" width="1663" x="77" y="2585.0313"/><rect fill="#FFFFFF" filter="url(#fv5e5zzx7z3u7)" height="80.3984" style="stroke: #000000; stroke-width: 2.0;" width="502" x="1213" y="2842.3594"/><rect fill="#FFFFFF" filter="url(#fv5e5zzx7z3u7)" height="464.9922" style="stroke: #000000; stroke-width: 2.0;" width="1262.5" x="77" y="3123.6875"/><rect fill="#FFFFFF" filter="url(#fv5e5zzx7z3u7)" height="93.3984" style="stroke: #000000; stroke-width: 2.0;" width="365.5" x="949" y="3191.9531"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="93" x2="93" y1="58.4297" y2="120.5625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="93" x2="93" y1="120.5625" y2="148.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="93" x2="93" y1="148.5625" y2="3632.6797"/><rect fill="#FFFFFF" filter="url(#fv5e5zzx7z3u7)" height="33" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="88" y="87.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="88" x2="88" y1="87.5625" y2="120.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="98" x2="98" y1="87.5625" y2="120.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="88" x2="98" y1="87.5625" y2="87.5625"/><rect fill="#FFFFFF" filter="url(#fv5e5zzx7z3u7)" height="3484.1172" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="88" y="148.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="88" x2="88" y1="148.5625" y2="3632.6797"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="98" x2="98" y1="148.5625" y2="3632.6797"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="88" x2="98" y1="3632.6797" y2="3632.6797"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="263" x2="263" y1="58.4297" y2="120.5625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="263" x2="263" y1="120.5625" y2="148.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="263" x2="263" y1="148.5625" y2="3632.6797"/><rect fill="#FFFFFF" filter="url(#fv5e5zzx7z3u7)" height="3383.7188" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="258" y="213.9609"/><rect fill="#90EE90" filter="url(#fv5e5zzx7z3u7)" height="3201.9219" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="263" y="342.4922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="406" x2="406" y1="58.4297" y2="120.5625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="406" x2="406" y1="120.5625" y2="148.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="406" x2="406" y1="148.5625" y2="3632.6797"/><rect fill="#FF9999" filter="url(#fv5e5zzx7z3u7)" height="3165.9219" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="401" y="466.7578"/><rect fill="#90EE90" filter="url(#fv5e5zzx7z3u7)" height="243.0273" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="406" y="602.9453"/><rect fill="#90EE90" filter="url(#fv5e5zzx7z3u7)" height="835.2852" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="406" y="889.1055"/><rect fill="#AAAAEE" filter="url(#fv5e5zzx7z3u7)" height="1604.4375" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="406" y="1906.8438"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="589" x2="589" y1="58.4297" y2="120.5625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="589" x2="589" y1="120.5625" y2="148.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="589" x2="589" y1="148.5625" y2="3632.6797"/><rect fill="#FFFFFF" filter="url(#fv5e5zzx7z3u7)" height="2990.2578" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="584" y="521.0234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="784" x2="784" y1="58.4297" y2="120.5625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="784" x2="784" y1="120.5625" y2="148.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="784" x2="784" y1="148.5625" y2="3632.6797"/><rect fill="#FFFFFF" filter="url(#fv5e5zzx7z3u7)" height="2172.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="779" y="1338.7969"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="965" x2="965" y1="58.4297" y2="120.5625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="965" x2="965" y1="120.5625" y2="148.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="965" x2="965" y1="148.5625" y2="3632.6797"/><rect fill="#FF9999" filter="url(#fv5e5zzx7z3u7)" height="2460.6797" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="960" y="1172"/><rect fill="#90EE90" filter="url(#fv5e5zzx7z3u7)" height="484.125" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="965" y="1248.2656"/><rect fill="#AAAAEE" filter="url(#fv5e5zzx7z3u7)" height="1644.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="965" y="1858.5781"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1229" x2="1229" y1="58.4297" y2="120.5625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1229" x2="1229" y1="120.5625" y2="148.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1229" x2="1229" y1="148.5625" y2="3632.6797"/><rect fill="#FFFFFF" filter="url(#fv5e5zzx7z3u7)" height="164.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1224" y="2137.0391"/><rect fill="#FFFFFF" filter="url(#fv5e5zzx7z3u7)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1224" y="3415.8828"/><rect fill="#FFFFFF" filter="url(#fv5e5zzx7z3u7)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1229" y="3386.75"/><rect fill="#FFFFFF" filter="url(#fv5e5zzx7z3u7)" height="71.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1234" y="3315.4844"/><rect fill="#FEFECE" filter="url(#fv5e5zzx7z3u7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="79" x="51.5" y="23.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="58.5" y="43.1279">Facilitator</text><rect fill="#FEFECE" filter="url(#fv5e5zzx7z3u7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="161" x="180.5" y="23.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="147" x="187.5" y="43.1279">Facilitator connection</text><rect fill="#FEFECE" filter="url(#fv5e5zzx7z3u7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="365.5" y="23.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="372.5" y="43.1279">Job driver</text><rect fill="#FEFECE" filter="url(#fv5e5zzx7z3u7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="149" x="512.5" y="23.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="135" x="519.5" y="43.1279">Validator Consumer</text><rect fill="#FEFECE" filter="url(#fv5e5zzx7z3u7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="151" x="706.5" y="23.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="137" x="713.5" y="43.1279">Executor Consumer</text><rect fill="#FEFECE" filter="url(#fv5e5zzx7z3u7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="75" x="925.5" y="23.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="61" x="932.5" y="43.1279">Executor</text><rect fill="#FEFECE" filter="url(#fv5e5zzx7z3u7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="135" x="1159.5" y="23.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="121" x="1166.5" y="43.1279">Task/Subprocess</text><rect fill="#FEFECE" filter="url(#fv5e5zzx7z3u7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="79" x="51.5" y="3632.6797"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="58.5" y="3652.6748">Facilitator</text><rect fill="#FEFECE" filter="url(#fv5e5zzx7z3u7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="161" x="180.5" y="3632.6797"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="147" x="187.5" y="3652.6748">Facilitator connection</text><rect fill="#FEFECE" filter="url(#fv5e5zzx7z3u7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="365.5" y="3632.6797"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="372.5" y="3652.6748">Job driver</text><rect fill="#FEFECE" filter="url(#fv5e5zzx7z3u7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="149" x="512.5" y="3632.6797"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="135" x="519.5" y="3652.6748">Validator Consumer</text><rect fill="#FEFECE" filter="url(#fv5e5zzx7z3u7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="151" x="706.5" y="3632.6797"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="137" x="713.5" y="3652.6748">Executor Consumer</text><rect fill="#FEFECE" filter="url(#fv5e5zzx7z3u7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="75" x="925.5" y="3632.6797"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="61" x="932.5" y="3652.6748">Executor</text><rect fill="#FEFECE" filter="url(#fv5e5zzx7z3u7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="135" x="1159.5" y="3632.6797"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="121" x="1166.5" y="3652.6748">Task/Subprocess</text><polygon fill="#A80036" points="109,83.5625,99,87.5625,109,91.5625,105,87.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="103" x2="262" y1="87.5625" y2="87.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="115" y="82.4966">Connect</text><polygon fill="#A80036" points="76,180.8281,86,184.8281,76,188.8281,80,184.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3" x2="82" y1="184.8281" y2="184.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="10" y="164.6294">Create job</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="10" y="179.7622">(HTTP)</text><polygon fill="#A80036" points="246,209.9609,256,213.9609,246,217.9609,250,213.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="98" x2="252" y1="213.9609" y2="213.9609"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="105" y="208.895">V2JobRequest</text><polygon fill="#A80036" points="109,254.2266,99,258.2266,109,262.2266,105,258.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="103" x2="257" y1="258.2266" y2="258.2266"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="115" y="238.0278">V0JobStatusUpdate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67" x="115" y="253.1606">(Received)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="268" x2="310" y1="287.3594" y2="287.3594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="310" x2="310" y1="287.3594" y2="300.3594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="269" x2="310" y1="300.3594" y2="300.3594"/><polygon fill="#A80036" points="279,296.3594,269,300.3594,279,304.3594,275,300.3594" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="275" y="282.2935">Pick miner</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="268" x2="315" y1="329.4922" y2="329.4922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="315" x2="315" y1="329.4922" y2="342.4922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="274" x2="315" y1="342.4922" y2="342.4922"/><polygon fill="#A80036" points="284,338.4922,274,342.4922,284,346.4922,280,342.4922" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="280" y="324.4263">Submit celery task</text><rect fill="#90EE90" filter="url(#fv5e5zzx7z3u7)" height="23" style="stroke: #A80036; stroke-width: 1.0;" width="140" x="278" y="355.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="282" y="371.5591">celery result timeout</text><rect fill="#FBFB77" filter="url(#fv5e5zzx7z3u7)" height="23" style="stroke: #A80036; stroke-width: 1.0;" width="256" x="206.5" y="413.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="239" y="429.6919">Waiting for celery task to start</text><rect fill="#FF9999" filter="url(#fv5e5zzx7z3u7)" height="23" style="stroke: #A80036; stroke-width: 1.0;" width="102" x="416" y="471.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="420" y="487.8247">celery task TTL</text><polygon fill="#A80036" points="572,517.0234,582,521.0234,572,525.0234,576,521.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="411" x2="578" y1="521.0234" y2="521.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="418" y="515.9575">Connect</text><rect fill="#EEEEEE" filter="url(#fv5e5zzx7z3u7)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1746" x="3" y="551.918"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1749" y1="551.918" y2="551.918"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1749" y1="554.918" y2="554.918"/><rect fill="#EEEEEE" filter="url(#fv5e5zzx7z3u7)" height="27.7891" style="stroke: #000000; stroke-width: 2.0;" width="124" x="814" y="539.0234"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="110" x="820" y="558.8032">Preparation</text><path d="M77,580.8125 L256,580.8125 L256,587.8125 L246,597.8125 L77,597.8125 L77,580.8125 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="273.1602" style="stroke: #000000; stroke-width: 2.0;" width="723" x="77" y="580.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="134" x="92" y="593.8794">Reservation stage</text><rect fill="#90EE90" filter="url(#fv5e5zzx7z3u7)" height="53" style="stroke: #A80036; stroke-width: 1.0;" width="166" x="421" y="607.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="425" y="624.0122">Timeout:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="158" x="425" y="639.145">reservation time limit</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="425" y="654.2778">(dynamic config)</text><polygon fill="#A80036" points="572,728.875,582,732.875,572,736.875,576,732.875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="416" x2="578" y1="732.875" y2="732.875"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="423" y="682.4106">V0InitialJobRequest</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="423" y="697.5435">-</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="432" y="697.5435">JobStartedReceipt</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="423" y="712.6763">- Executor class</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="423" y="727.8091">- Job timing</text><path d="M599,703.1758 L599,758.1758 L773,758.1758 L773,713.1758 L763,703.1758 L599,703.1758 " fill="#FBFB77" filter="url(#fv5e5zzx7z3u7)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M763,703.1758 L763,713.1758 L773,713.1758 L763,703.1758 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="605" y="720.2427">This is essentially a dual</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="605" y="735.3755">reserve+start executor</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="605" y="750.5083">request in one</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="594" x2="636" y1="788.707" y2="788.707"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="636" x2="636" y1="788.707" y2="801.707"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="595" x2="636" y1="801.707" y2="801.707"/><polygon fill="#A80036" points="605,797.707,595,801.707,605,805.707,601,801.707" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="601" y="783.6411">Reserve executor from pool</text><polygon fill="#A80036" points="427,841.9727,417,845.9727,427,849.9727,423,845.9727" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="421" x2="583" y1="845.9727" y2="845.9727"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="433" y="840.9067">V0AcceptJobRequest</text><polygon fill="#A80036" points="109,841.9727,99,845.9727,109,849.9727,105,845.9727" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="103" x2="400" y1="845.9727" y2="845.9727"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="115" y="825.7739">V0JobStatusUpdate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="115" y="840.9067">(Accepted)</text><path d="M349.5,866.9727 L492.5,866.9727 L492.5,873.9727 L482.5,883.9727 L349.5,883.9727 L349.5,866.9727 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="346.1602" style="stroke: #000000; stroke-width: 2.0;" width="735.5" x="349.5" y="866.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="98" x="364.5" y="880.0396">Spinup stage</text><rect fill="#90EE90" filter="url(#fv5e5zzx7z3u7)" height="83" style="stroke: #A80036; stroke-width: 1.0;" width="169" x="421" y="898.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="425" y="914.7388">Timeout:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="161" x="425" y="929.8716">executor class spinup</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="425" y="945.0044">(depends on class)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="11" x="425" y="960.1372">+</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="129" x="440" y="960.1372">startup time limit</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="425" y="975.27">(dynamic config)</text><polygon fill="#A80036" points="953,936.5039,963,940.5039,953,944.5039,957,940.5039" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="594" x2="959" y1="940.5039" y2="940.5039"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="601" y="905.1724">Start executor</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="601" y="920.3052">(via vendor code)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="320" x="601" y="935.438">(pass executor TTL to deal with zombie executors)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="965" x2="1007" y1="1008.4688" y2="1008.4688"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1007" x2="1007" y1="1008.4688" y2="1021.4688"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="966" x2="1007" y1="1021.4688" y2="1021.4688"/><polygon fill="#A80036" points="976,1017.4688,966,1021.4688,976,1025.4688,972,1021.4688" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="972" y="1003.4028">...</text><rect fill="#FBFB77" filter="url(#fv5e5zzx7z3u7)" height="23" style="stroke: #A80036; stroke-width: 1.0;" width="629" x="371" y="1034.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="173" x="599" y="1050.5356">Waiting for executor spinup</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="965" x2="1007" y1="1083.7344" y2="1083.7344"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1007" x2="1007" y1="1083.7344" y2="1096.7344"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="966" x2="1007" y1="1096.7344" y2="1096.7344"/><polygon fill="#A80036" points="976,1092.7344,966,1096.7344,976,1100.7344,972,1096.7344" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="972" y="1078.6685">...</text><rect fill="#FBFB77" filter="url(#fv5e5zzx7z3u7)" height="23" style="stroke: #A80036; stroke-width: 1.0;" width="629" x="371" y="1109.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="356" x="507.5" y="1125.8013">Always-on executors need a couple of seconds here too</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="965" x2="1012" y1="1159" y2="1159"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1012" x2="1012" y1="1159" y2="1172"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="971" x2="1012" y1="1172" y2="1172"/><polygon fill="#A80036" points="981,1168,971,1172,981,1176,977,1172" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="977" y="1153.9341">...</text><rect fill="#FF9999" filter="url(#fv5e5zzx7z3u7)" height="23" style="stroke: #A80036; stroke-width: 1.0;" width="89" x="975" y="1185"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="979" y="1201.0669">executor TTL</text><path d="M77,1226.1328 L224,1226.1328 L224,1233.1328 L214,1243.1328 L77,1243.1328 L77,1226.1328 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="506.2578" style="stroke: #000000; stroke-width: 2.0;" width="1254" x="77" y="1226.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="102" x="92" y="1239.1997">Startup stage</text><rect fill="#90EE90" filter="url(#fv5e5zzx7z3u7)" height="38" style="stroke: #A80036; stroke-width: 1.0;" width="137" x="980" y="1263.832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="984" y="1279.8989">Timeout:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="129" x="984" y="1295.0317">startup time limit</text><path d="M742,1253.2656 L742,1308.2656 L956,1308.2656 L956,1263.2656 L946,1253.2656 L742,1253.2656 " fill="#FBFB77" filter="url(#fv5e5zzx7z3u7)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M946,1253.2656 L946,1263.2656 L956,1263.2656 L946,1253.2656 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="748" y="1270.3325">Startup time is constant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="748" y="1285.4653">unless we want to allow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="748" y="1300.5981">heavy volume downloads here</text><polygon fill="#A80036" points="800,1334.7969,790,1338.7969,800,1342.7969,796,1338.7969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="794" x2="959" y1="1338.7969" y2="1338.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="806" y="1333.731">Connect</text><polygon fill="#A80036" points="953,1363.9297,963,1367.9297,953,1371.9297,957,1367.9297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="789" x2="959" y1="1367.9297" y2="1367.9297"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="796" y="1362.8638">V0InitialJobRequest</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="975" x2="1017" y1="1397.0625" y2="1397.0625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1017" x2="1017" y1="1397.0625" y2="1410.0625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="976" x2="1017" y1="1410.0625" y2="1410.0625"/><polygon fill="#A80036" points="986,1406.0625,976,1410.0625,986,1414.0625,982,1410.0625" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67" x="982" y="1391.9966">CVE check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="975" x2="1017" y1="1439.1953" y2="1439.1953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1017" x2="1017" y1="1439.1953" y2="1452.1953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="976" x2="1017" y1="1452.1953" y2="1452.1953"/><polygon fill="#A80036" points="986,1448.1953,976,1452.1953,986,1456.1953,982,1452.1953" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="982" y="1434.1294">toolkit ver. check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="975" x2="1017" y1="1481.3281" y2="1481.3281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1017" x2="1017" y1="1481.3281" y2="1494.3281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="976" x2="1017" y1="1494.3281" y2="1494.3281"/><polygon fill="#A80036" points="986,1490.3281,976,1494.3281,986,1498.3281,982,1494.3281" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="982" y="1476.2622">clear old jobs</text><path d="M949,1506.3281 L1222,1506.3281 L1222,1513.3281 L1212,1523.3281 L949,1523.3281 L949,1506.3281 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="172.7969" style="stroke: #000000; stroke-width: 2.0;" width="357" x="949" y="1506.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="228" x="964" y="1519.395">docker image in initial details?</text><path d="M980,1533.4609 L980,1588.4609 L1281,1588.4609 L1281,1543.4609 L1271,1533.4609 L980,1533.4609 " fill="#FBFB77" filter="url(#fv5e5zzx7z3u7)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1271,1533.4609 L1271,1543.4609 L1281,1543.4609 L1271,1533.4609 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="986" y="1550.5278">this is only for small images, large job</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="280" x="986" y="1565.6606">images must be preloaded somewhere else</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="986" y="1580.7935">or this takes too long</text><path d="M980,1602.8594 L980,1627.8594 L1261,1627.8594 L1261,1612.8594 L1251,1602.8594 L980,1602.8594 " fill="#FBFB77" filter="url(#fv5e5zzx7z3u7)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1251,1602.8594 L1251,1612.8594 L1261,1612.8594 L1251,1602.8594 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="260" x="986" y="1619.9263">if image is preloaded, this will exit quickly</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="975" x2="1017" y1="1658.125" y2="1658.125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1017" x2="1017" y1="1658.125" y2="1671.125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="976" x2="1017" y1="1671.125" y2="1671.125"/><polygon fill="#A80036" points="986,1667.125,976,1671.125,986,1675.125,982,1671.125" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="982" y="1653.0591">pull docker image</text><polygon fill="#A80036" points="427,1720.3906,417,1724.3906,427,1728.3906,423,1724.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="421" x2="959" y1="1724.3906" y2="1724.3906"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="433" y="1719.3247">V0ExecutorReadyRequest</text><polygon fill="#A80036" points="109,1720.3906,99,1724.3906,109,1728.3906,105,1724.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="103" x2="400" y1="1724.3906" y2="1724.3906"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="115" y="1704.1919">V0JobStatusUpdate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="115" y="1719.3247">(Executor ready)</text><rect fill="#EEEEEE" filter="url(#fv5e5zzx7z3u7)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1746" x="3" y="1764.2852"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1749" y1="1764.2852" y2="1764.2852"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1749" y1="1767.2852" y2="1767.2852"/><rect fill="#EEEEEE" filter="url(#fv5e5zzx7z3u7)" height="27.7891" style="stroke: #000000; stroke-width: 2.0;" width="142" x="805" y="1751.3906"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="128" x="811" y="1771.1704">Job execution</text><path d="M368.5,1794.1797 L368.5,1849.1797 L998.5,1849.1797 L998.5,1804.1797 L988.5,1794.1797 L368.5,1794.1797 " fill="#FBFB77" filter="url(#fv5e5zzx7z3u7)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M988.5,1794.1797 L988.5,1804.1797 L998.5,1804.1797 L988.5,1794.1797 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="429" x="374.5" y="1811.2466">It's important for both parties to start the deadline timer right here.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="515" x="374.5" y="1826.3794">In practice, the validator will start its timer a bit later than executor - this is good,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="609" x="374.5" y="1841.5122">as the validator is then less likely to time out before the executor. (unless the executor is dead)</text><rect fill="#AAAAEE" filter="url(#fv5e5zzx7z3u7)" height="38" style="stroke: #A80036; stroke-width: 1.0;" width="92" x="980" y="1863.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="984" y="1879.645">Set deadline:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="51" x="984" y="1894.7778">leeway</text><rect fill="#AAAAEE" filter="url(#fv5e5zzx7z3u7)" height="38" style="stroke: #A80036; stroke-width: 1.0;" width="92" x="421" y="1911.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="425" y="1927.9106">Set deadline:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="51" x="425" y="1943.0435">leeway</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="975" x2="1017" y1="1976.2422" y2="1976.2422"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1017" x2="1017" y1="1976.2422" y2="1989.2422"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="976" x2="1017" y1="1989.2422" y2="1989.2422"/><polygon fill="#A80036" points="986,1985.2422,976,1989.2422,986,1993.2422,982,1989.2422" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="982" y="1971.1763">Generate streaming server certificate</text><path d="M77,2001.2422 L242,2001.2422 L242,2008.2422 L232,2018.2422 L77,2018.2422 L77,2001.2422 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="352.7266" style="stroke: #000000; stroke-width: 2.0;" width="1400" x="77" y="2001.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="120" x="92" y="2014.3091">Download stage</text><rect fill="#AAAAEE" filter="url(#fv5e5zzx7z3u7)" height="38" style="stroke: #A80036; stroke-width: 1.0;" width="155" x="421" y="2028.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="425" y="2044.4419">Extend deadline:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="147" x="425" y="2059.5747">download time limit</text><rect fill="#AAAAEE" filter="url(#fv5e5zzx7z3u7)" height="38" style="stroke: #A80036; stroke-width: 1.0;" width="155" x="980" y="2028.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="984" y="2044.4419">Extend deadline:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="147" x="984" y="2059.5747">download time limit</text><polygon fill="#A80036" points="953,2103.9063,963,2107.9063,953,2111.9063,957,2107.9063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="416" x2="959" y1="2107.9063" y2="2107.9063"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="423" y="2087.7075">V0JobRequest</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="423" y="2102.8403">- Job volumes</text><polygon fill="#A80036" points="1212,2133.0391,1222,2137.0391,1212,2141.0391,1216,2137.0391" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="975" x2="1218" y1="2137.0391" y2="2137.0391"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="982" y="2131.9731">unpack_volume()</text><path d="M1239,2150.0391 L1239,2190.0391 L1420,2190.0391 L1420,2160.0391 L1410,2150.0391 L1239,2150.0391 " fill="#FBFB77" filter="url(#fv5e5zzx7z3u7)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1410,2150.0391 L1410,2160.0391 L1420,2160.0391 L1410,2150.0391 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="1245" y="2167.106">Implementation depends</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="1245" y="2182.2388">on volume type</text><path d="M1239,2204.3047 L1239,2229.3047 L1452,2229.3047 L1452,2214.3047 L1442,2204.3047 L1239,2204.3047 " fill="#FBFB77" filter="url(#fv5e5zzx7z3u7)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1442,2204.3047 L1442,2214.3047 L1452,2214.3047 L1442,2204.3047 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="1245" y="2221.3716">Multi volume does a loop here</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1234" x2="1276" y1="2259.5703" y2="2259.5703"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1276" x2="1276" y1="2259.5703" y2="2272.5703"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1235" x2="1276" y1="2272.5703" y2="2272.5703"/><polygon fill="#A80036" points="1245,2268.5703,1235,2272.5703,1245,2276.5703,1241,2272.5703" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="1241" y="2254.5044">Download</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="1318" y="2254.5044">+ unpack</text><polygon fill="#A80036" points="986,2297.7031,976,2301.7031,986,2305.7031,982,2301.7031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="980" x2="1223" y1="2301.7031" y2="2301.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="992" y="2296.6372">done</text><polygon fill="#A80036" points="427,2341.9688,417,2345.9688,427,2349.9688,423,2345.9688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="421" x2="959" y1="2345.9688" y2="2345.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="433" y="2340.9028">V0VolumesReady</text><polygon fill="#A80036" points="109,2341.9688,99,2345.9688,109,2349.9688,105,2345.9688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="103" x2="400" y1="2345.9688" y2="2345.9688"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="115" y="2325.77">V0JobStatusUpdate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="115" y="2340.9028">(Volumes ready)</text><path d="M77,2366.9688 L285,2366.9688 L285,2373.9688 L275,2383.9688 L77,2383.9688 L77,2366.9688 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="156.7969" style="stroke: #000000; stroke-width: 2.0;" width="1122" x="77" y="2366.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="163" x="92" y="2380.0356">Start streaming stage</text><rect fill="#AAAAEE" filter="url(#fv5e5zzx7z3u7)" height="38" style="stroke: #A80036; stroke-width: 1.0;" width="198" x="421" y="2394.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="425" y="2410.1685">Extend deadline:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="190" x="425" y="2425.3013">streaming start time limit</text><rect fill="#AAAAEE" filter="url(#fv5e5zzx7z3u7)" height="38" style="stroke: #A80036; stroke-width: 1.0;" width="198" x="980" y="2394.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="984" y="2410.1685">Extend deadline:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="190" x="984" y="2425.3013">streaming start time limit</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="975" x2="1017" y1="2458.5" y2="2458.5"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1017" x2="1017" y1="2458.5" y2="2471.5"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="976" x2="1017" y1="2471.5" y2="2471.5"/><polygon fill="#A80036" points="986,2467.5,976,2471.5,986,2475.5,982,2471.5" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="982" y="2453.4341">"Start streaming server"</text><polygon fill="#A80036" points="427,2511.7656,417,2515.7656,427,2519.7656,423,2515.7656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="421" x2="959" y1="2515.7656" y2="2515.7656"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="433" y="2495.5669">V0StreamingJobReady</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="433" y="2510.6997">(server address and public certificate)</text><polygon fill="#A80036" points="109,2511.7656,99,2515.7656,109,2519.7656,105,2515.7656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="103" x2="400" y1="2515.7656" y2="2515.7656"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="115" y="2495.5669">V0JobStatusUpdate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="115" y="2510.6997">(Streaming ready)</text><rect fill="#AAAAEE" filter="url(#fv5e5zzx7z3u7)" height="38" style="stroke: #A80036; stroke-width: 1.0;" width="154" x="421" y="2537.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="425" y="2553.8325">Extend deadline:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="146" x="425" y="2568.9653">execution time limit</text><rect fill="#AAAAEE" filter="url(#fv5e5zzx7z3u7)" height="38" style="stroke: #A80036; stroke-width: 1.0;" width="154" x="980" y="2537.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="984" y="2553.8325">Extend deadline:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="146" x="984" y="2568.9653">execution time limit</text><path d="M77,2585.0313 L240,2585.0313 L240,2592.0313 L230,2602.0313 L77,2602.0313 L77,2585.0313 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="477.3906" style="stroke: #000000; stroke-width: 2.0;" width="1663" x="77" y="2585.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="92" y="2598.0981">Execution stage</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="975" x2="1017" y1="2688.8281" y2="2688.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1017" x2="1017" y1="2688.8281" y2="2701.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="976" x2="1017" y1="2701.8281" y2="2701.8281"/><polygon fill="#A80036" points="986,2697.8281,976,2701.8281,986,2705.8281,982,2701.8281" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="982" y="2623.231">Vendor code (or default job runner):</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="982" y="2638.3638">get_docker_run_args()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="982" y="2653.4966">get_docker_image()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="982" y="2668.6294">get_docker_run_cmd()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="982" y="2683.7622">before_start_job()</text><polygon fill="#A80036" points="1217,2726.9609,1227,2730.9609,1217,2734.9609,1221,2730.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="975" x2="1223" y1="2730.9609" y2="2730.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="982" y="2725.895">docker run</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="975" x2="1017" y1="2775.2266" y2="2775.2266"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1017" x2="1017" y1="2775.2266" y2="2788.2266"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="976" x2="1017" y1="2788.2266" y2="2788.2266"/><polygon fill="#A80036" points="986,2784.2266,976,2788.2266,986,2792.2266,982,2788.2266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="982" y="2755.0278">Vendor code (or default job runner):</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="982" y="2770.1606">after_start_job()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1229" x2="1271" y1="2817.3594" y2="2817.3594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1271" x2="1271" y1="2817.3594" y2="2830.3594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1230" x2="1271" y1="2830.3594" y2="2830.3594"/><polygon fill="#A80036" points="1240,2826.3594,1230,2830.3594,1240,2834.3594,1236,2830.3594" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="73" x="1236" y="2812.2935">Actual work</text><path d="M1213,2842.3594 L1290,2842.3594 L1290,2849.3594 L1280,2859.3594 L1213,2859.3594 L1213,2842.3594 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="80.3984" style="stroke: #000000; stroke-width: 2.0;" width="502" x="1213" y="2842.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="1228" y="2855.4263">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="394" x="1305" y="2854.5698">[streaming - until client terminates the job or timeout occurs]</text><polygon fill="#A80036" points="1240,2881.625,1230,2885.625,1240,2889.625,1236,2885.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1234" x2="1748" y1="2885.625" y2="2885.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="1246" y="2880.5591">Requests are signed using</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="120" x="1418" y="2880.5591">client certificate</text><polygon fill="#A80036" points="1737,2910.7578,1747,2914.7578,1737,2918.7578,1741,2914.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1229" x2="1743" y1="2914.7578" y2="2914.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="1236" y="2909.6919">Responses are signed using</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="103" x="1418" y="2909.6919">job certificate</text><polygon fill="#A80036" points="986,2948.8906,976,2952.8906,986,2956.8906,982,2952.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="980" x2="1228" y1="2952.8906" y2="2952.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="992" y="2947.8247">stdout, stderr</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="975" x2="1017" y1="2997.1563" y2="2997.1563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1017" x2="1017" y1="2997.1563" y2="3010.1563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="976" x2="1017" y1="3010.1563" y2="3010.1563"/><polygon fill="#A80036" points="986,3006.1563,976,3010.1563,986,3014.1563,982,3010.1563" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="982" y="2976.9575">Vendor code (or default job runner):</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="982" y="2992.0903">job_cleanup()</text><polygon fill="#A80036" points="427,3050.4219,417,3054.4219,427,3058.4219,423,3054.4219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="421" x2="959" y1="3054.4219" y2="3054.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="433" y="3049.356">V0ExecutionDone</text><polygon fill="#A80036" points="109,3050.4219,99,3054.4219,109,3058.4219,105,3054.4219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="103" x2="400" y1="3054.4219" y2="3054.4219"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="115" y="3034.2231">V0JobStatusUpdate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="115" y="3049.356">(Execution done)</text><rect fill="#AAAAEE" filter="url(#fv5e5zzx7z3u7)" height="38" style="stroke: #A80036; stroke-width: 1.0;" width="134" x="421" y="3076.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="425" y="3092.4888">Extend deadline:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="126" x="425" y="3107.6216">upload time limit</text><rect fill="#AAAAEE" filter="url(#fv5e5zzx7z3u7)" height="38" style="stroke: #A80036; stroke-width: 1.0;" width="134" x="980" y="3076.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="984" y="3092.4888">Extend deadline:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="126" x="984" y="3107.6216">upload time limit</text><path d="M77,3123.6875 L221,3123.6875 L221,3130.6875 L211,3140.6875 L77,3140.6875 L77,3123.6875 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="464.9922" style="stroke: #000000; stroke-width: 2.0;" width="1262.5" x="77" y="3123.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="92" y="3136.7544">Upload stage</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="975" x2="1017" y1="3166.9531" y2="3166.9531"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1017" x2="1017" y1="3166.9531" y2="3179.9531"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="976" x2="1017" y1="3179.9531" y2="3179.9531"/><polygon fill="#A80036" points="986,3175.9531,976,3179.9531,986,3183.9531,982,3179.9531" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="982" y="3161.8872">Serialize artifacts</text><path d="M949,3191.9531 L1026,3191.9531 L1026,3198.9531 L1016,3208.9531 L949,3208.9531 L949,3191.9531 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="93.3984" style="stroke: #000000; stroke-width: 2.0;" width="365.5" x="949" y="3191.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="964" y="3205.02">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5" x="1041" y="3204.1636">[</text><text fill="#000000" font-family="monospace" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="175" x="1046" y="3204.1636">MultiUploadOutputUploader</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5" x="1221" y="3204.1636">]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="975" x2="1017" y1="3235.2188" y2="3235.2188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1017" x2="1017" y1="3235.2188" y2="3248.2188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="976" x2="1017" y1="3248.2188" y2="3248.2188"/><polygon fill="#A80036" points="986,3244.2188,976,3248.2188,986,3252.2188,982,3248.2188" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="982" y="3230.1528">Zip the volume</text><polygon fill="#A80036" points="1217,3273.3516,1227,3277.3516,1217,3281.3516,1221,3277.3516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="975" x2="1223" y1="3277.3516" y2="3277.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="982" y="3272.2856">Start upload</text><polygon fill="#A80036" points="1222,3311.4844,1232,3315.4844,1222,3319.4844,1226,3315.4844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="975" x2="1228" y1="3315.4844" y2="3315.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="982" y="3310.4185">Upload stdout/stderr</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="975" x2="1017" y1="3344.6172" y2="3344.6172"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1017" x2="1017" y1="3344.6172" y2="3357.6172"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="976" x2="1017" y1="3357.6172" y2="3357.6172"/><polygon fill="#A80036" points="986,3353.6172,976,3357.6172,986,3361.6172,982,3357.6172" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="982" y="3339.5513">await upload tasks</text><polygon fill="#A80036" points="986,3382.75,976,3386.75,986,3390.75,982,3386.75" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="980" x2="1223" y1="3386.75" y2="3386.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="992" y="3381.6841">Upload done</text><polygon fill="#A80036" points="986,3411.8828,976,3415.8828,986,3419.8828,982,3415.8828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="980" x2="1223" y1="3415.8828" y2="3415.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="992" y="3410.8169">Upload done</text><polygon fill="#A80036" points="986,3441.0156,976,3445.0156,986,3449.0156,982,3445.0156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="980" x2="1223" y1="3445.0156" y2="3445.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="992" y="3439.9497">Upload done</text><polygon fill="#A80036" points="986,3470.1484,976,3474.1484,986,3478.1484,982,3474.1484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="980" x2="1228" y1="3474.1484" y2="3474.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="992" y="3469.0825">Upload done</text><polygon fill="#A80036" points="427,3499.2813,417,3503.2813,427,3507.2813,423,3503.2813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="421" x2="959" y1="3503.2813" y2="3503.2813"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="433" y="3498.2153">V0JobFinished</text><rect fill="#FBFB77" filter="url(#fv5e5zzx7z3u7)" height="23" style="stroke: #A80036; stroke-width: 1.0;" width="188" x="169" y="3516.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="173" y="3532.3481">Waiting for celery task result</text><polygon fill="#A80036" points="109,3576.6797,99,3580.6797,109,3584.6797,105,3580.6797" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="103" x2="257" y1="3580.6797" y2="3580.6797"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="115" y="3560.481">V0JobStatusUpdate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="115" y="3575.6138">(Complete)</text><!--MD5=[25055732f6cd294a5305d101eaf366b3]
@startuml
!pragma teoz true
skinparam sequenceBoxBorderColor #gray
box Facilitator #ffb
participant Facilitator
end box
box Validator #eef5ff
participant "Facilitator connection"
participant "Job driver"
end box
box Miner #lightyellow
participant "Validator Consumer"
participant "Executor Consumer"
end box
box Executor #efefef
participant Executor
participant "Task/Subprocess"
end box

"Facilitator connection" -> Facilitator: Connect
activate Facilitator
|||
...

-> Facilitator: Create job\n(HTTP)
Facilitator -> "Facilitator connection": ""V2JobRequest""
activate "Facilitator connection"
"Facilitator connection" -> Facilitator: ""V0JobStatusUpdate""\n(Received)

"Facilitator connection" -> "Facilitator connection": Pick miner
"Facilitator connection" -> "Facilitator connection": Submit celery task
activate "Facilitator connection" #lightgreen
rnote right of "Facilitator connection" #lightgreen: celery result timeout
|||
rnote over "Facilitator connection", "Job driver": Waiting for celery task to start
|||
activate "Job driver" #f99
rnote right of "Job driver" #f99: celery task TTL
"Job driver" -> "Validator Consumer": Connect
activate "Validator Consumer"


== =Preparation ==

group Reservation stage
activate "Job driver" #lightgreen
rnote right of "Job driver" #lightgreen: Timeout:\n**reservation time limit**\n(dynamic config)
"Job driver" -> "Validator Consumer": ""V0InitialJobRequest""\n- ""JobStartedReceipt""\n- Executor class\n- Job timing
&note right of "Validator Consumer": This is essentially a dual\nreserve+start executor\nrequest in one
"Validator Consumer" -> "Validator Consumer": Reserve executor from pool
"Validator Consumer" -> "Job driver": ""V0AcceptJobRequest""
&"Job driver" -> Facilitator: ""V0JobStatusUpdate""\n(Accepted)
deactivate "Job driver"
end group

group Spinup stage
activate "Job driver" #lightgreen
rnote right of "Job driver" #lightgreen: Timeout:\n**executor class spinup**\n(depends on class)\n+ **startup time limit**\n(dynamic config)
&"Validator Consumer" - -> Executor: Start executor\n(via vendor code)\n(pass executor TTL to deal with zombie executors)
Executor -> Executor: ...
rnote over "Job driver", Executor: Waiting for executor spinup
Executor -> Executor: ...
rnote over "Job driver", Executor: Always-on executors need a couple of seconds here too
Executor -> Executor: ...

activate Executor #f99
rnote right of Executor #f99: executor TTL
end group

group Startup stage
activate Executor #lightgreen
rnote right of "Executor" #lightgreen: Timeout:\n**startup time limit**
&note left of "Executor": Startup time is constant\nunless we want to allow\nheavy volume downloads here

Executor -> "Executor Consumer": Connect
activate "Executor Consumer"
"Executor Consumer" -> Executor: ""V0InitialJobRequest""
Executor -> "Executor": CVE check
Executor -> "Executor": toolkit ver. check
Executor -> Executor: clear old jobs
group docker image in initial details?
note right of Executor: this is only for small images, large job\nimages must be preloaded somewhere else\nor this takes too long
note right of Executor: if image is preloaded, this will exit quickly
Executor -> Executor: pull docker image
end group
Executor -> "Job driver": ""V0ExecutorReadyRequest""
&"Job driver" -> Facilitator: ""V0JobStatusUpdate""\n(Executor ready)
deactivate "Job driver"
deactivate Executor
end group

== =Job execution ==
note over "Job driver", "Executor": It's important for both parties to start the deadline timer right here.\nIn practice, the validator will start its timer a bit later than executor - this is good,\nas the validator is then less likely to time out before the executor. (unless the executor is dead)

activate Executor #aae
rnote right of Executor #aae: Set deadline:\n**leeway**
activate "Job driver" #aae
rnote right of "Job driver" #aae: Set deadline:\n**leeway**

Executor -> Executor: Generate streaming server certificate

group Download stage
rnote right of "Job driver" #aae: Extend deadline:\n**download time limit**
&rnote right of Executor #aae: Extend deadline:\n**download time limit**

"Job driver" -> "Executor": ""V0JobRequest""\n- Job volumes
Executor -> "Task/Subprocess": ""unpack_volume()""
activate "Task/Subprocess"
note right of "Task/Subprocess": Implementation depends\non volume type
note right of "Task/Subprocess": Multi volume does a loop here
"Task/Subprocess" -> "Task/Subprocess": **Download** + unpack
return done
deactivate "Task/Subprocess"
"Executor" -> "Job driver": V0VolumesReady
&"Job driver" -> Facilitator: ""V0JobStatusUpdate""\n(Volumes ready)
end group

group Start streaming stage
rnote right of "Job driver" #aae: Extend deadline:\n**streaming start time limit**
&rnote right of Executor #aae: Extend deadline:\n**streaming start time limit**
Executor -> Executor: "Start streaming server"
"Executor" -> "Job driver": ""V0StreamingJobReady""\n(server address and public certificate)
&"Job driver" -> Facilitator: ""V0JobStatusUpdate""\n(Streaming ready)
end group

rnote right of "Job driver" #aae: Extend deadline:\n**execution time limit**
&rnote right of Executor #aae: Extend deadline:\n**execution time limit**
group Execution stage

Executor -> Executor: Vendor code (or default job runner):\nget_docker_run_args()\nget_docker_image()\nget_docker_run_cmd()\nbefore_start_job()
Executor - -> "Task/Subprocess": docker run
Executor -> Executor: Vendor code (or default job runner):\nafter_start_job()
activate "Task/Subprocess"
"Task/Subprocess" -> "Task/Subprocess": Actual work
loop streaming - until client terminates the job or timeout occurs
"Task/Subprocess"<-: Requests are signed using **client certificate**
"Task/Subprocess"->: Responses are signed using **job certificate**
end
"Task/Subprocess" -> Executor: stdout, stderr
deactivate "Task/Subprocess"
Executor -> Executor: Vendor code (or default job runner):\njob_cleanup()

"Executor" -> "Job driver": V0ExecutionDone
&"Job driver" -> Facilitator: ""V0JobStatusUpdate""\n(Execution done)
end group

rnote right of "Job driver" #aae: Extend deadline:\n**upload time limit**
&rnote right of Executor #aae: Extend deadline:\n**upload time limit**
group Upload stage

Executor -> Executor: Serialize artifacts
loop ""MultiUploadOutputUploader""
Executor -> Executor: Zip the volume
Executor -> "Task/Subprocess": Start upload
activate "Task/Subprocess"
activate "Task/Subprocess"
activate "Task/Subprocess"
end loop
Executor -> "Task/Subprocess": Upload stdout/stderr
activate "Task/Subprocess"
Executor -> Executor: await upload tasks
"Task/Subprocess" - -> Executor: Upload done
deactivate "Task/Subprocess"
"Task/Subprocess" - -> Executor: Upload done
deactivate "Task/Subprocess"
"Task/Subprocess" - -> Executor: Upload done
deactivate "Task/Subprocess"
"Task/Subprocess" - -> Executor: Upload done
deactivate "Task/Subprocess"
Executor -> "Job driver": ""V0JobFinished""
deactivate Executor
deactivate "Job driver"

deactivate "Executor Consumer"
deactivate "Validator Consumer"
deactivate "Job driver"
deactivate Executor

rnote over "Facilitator connection": Waiting for celery task result
deactivate "Facilitator connection"
"Facilitator connection" -> Facilitator: ""V0JobStatusUpdate""\n(Complete)
end group

deactivate "Facilitator connection"
|||
@enduml

PlantUML version 1.2020.02(Sun Mar 01 11:22:07 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.27+6-post-Ubuntu-0ubuntu122.04
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>